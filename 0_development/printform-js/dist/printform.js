var PrintForm=function(){"use strict";const G=new Set(["y","yes","true","1"]),j=new Set(["n","no","false","0"]);function u(r,o){if(r==null||r==="")return o;if(typeof r=="boolean")return r;if(typeof r=="number")return r!==0;const e=String(r).trim().toLowerCase();return G.has(e)?!0:j.has(e)?!1:o}function S(r,o){if(r==null||r==="")return o;const e=Number(r);return Number.isFinite(e)?e:o}function C(r,o){return r==null||r===""?o:String(r)}function X(r){const o=String(r||"").trim().toLowerCase();return o==="landscape"?"landscape":o==="portrait"?"portrait":""}function Z(r){const o=String(r||"").trim();if(!o)return"";const e=o.toUpperCase();return e==="A4"||e==="A5"||e==="LETTER"||e==="LEGAL"?e:e==="US_LETTER"||e==="USLETTER"?"LETTER":e==="US_LEGAL"||e==="USLEGAL"?"LEGAL":""}function $(r,o){const e=Number(r),t=Number(o);return!Number.isFinite(e)||!Number.isFinite(t)||t<=0?0:Math.round(e/25.4*t)}const J={A4:{widthMm:210,heightMm:297},A5:{widthMm:148,heightMm:210},LETTER:{widthMm:215.9,heightMm:279.4},LEGAL:{widthMm:215.9,heightMm:355.6}};function Q(r){const o=Z(r&&r.paperSize);if(!o)return null;const e=J[o];if(!e)return null;const t=Number(r&&r.dpi),a=$(e.widthMm,t),n=$(e.heightMm,t);return!a||!n?null:(X(r&&r.orientation)||"portrait")==="landscape"?{width:n,height:a}:{width:a,height:n}}function g(r){const o=Number(r);return Number.isFinite(o)?Math.max(0,Math.round(o)):0}function Y(r){if(!r)return null;if(r.__pageNumberPlaceholder)return r.__pageNumberPlaceholder;const o=r.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;let e=r.querySelector("[data-page-number-container]");e||(e=r.querySelector("td:last-child")||r.querySelector("td")||r);const t=o.createElement("span");return t.className="printform_page_number_placeholder",e.appendChild(t),r.__pageNumberPlaceholder=t,t}function ee(r){if(!r)return null;if(r.__physicalPageNumberPlaceholder)return r.__physicalPageNumberPlaceholder;const o=r.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;let e=r.querySelector("[data-physical-page-number-container]");e||(e=r.querySelector("td:last-child")||r.querySelector("td")||r);const t=o.createElement("span");return t.className="printform_physical_page_number_placeholder",e.appendChild(t),r.__physicalPageNumberPlaceholder=t,t}function K(r,o,e){if(!r)return;const t=r.querySelectorAll("[data-page-number]");t.length>0&&t.forEach(function(i){i.textContent=o});const a=r.querySelectorAll("[data-page-total]"),n=e??"";if(a.length>0&&a.forEach(function(i){i.textContent=n}),t.length===0&&a.length===0){const i=Y(r);i&&(i.textContent=e!=null?"Page "+o+" of "+e:"Page "+o)}}function A(r,o,e){if(!r)return;const t=r.querySelectorAll("[data-physical-page-number]");t.length>0&&t.forEach(function(i){i.textContent=o});const a=r.querySelectorAll("[data-physical-page-total]"),n=e??"";if(a.length>0&&a.forEach(function(i){i.textContent=n}),t.length===0&&a.length===0){const i=ee(r);i&&(i.textContent=e!=null?"Sheet "+o+" of "+e:"Sheet "+o)}}const L=[{key:"papersizeWidth",datasetKey:"papersizeWidth",legacyKey:"papersize_width",defaultValue:750,parser:S},{key:"papersizeHeight",datasetKey:"papersizeHeight",legacyKey:"papersize_height",defaultValue:1050,parser:S},{key:"paperSize",datasetKey:"paperSize",legacyKey:"paper_size",defaultValue:"",parser:C},{key:"orientation",datasetKey:"orientation",legacyKey:"orientation",defaultValue:"portrait",parser:C},{key:"dpi",datasetKey:"dpi",legacyKey:"dpi",defaultValue:96,parser:S},{key:"nUp",datasetKey:"nUp",legacyKey:"n_up",defaultValue:1,parser:S},{key:"showLogicalPageNumber",datasetKey:"showLogicalPageNumber",legacyKey:"show_logical_page_number",defaultValue:!0,parser:u},{key:"showPhysicalPageNumber",datasetKey:"showPhysicalPageNumber",legacyKey:"show_physical_page_number",defaultValue:!1,parser:u},{key:"heightOfDummyRowItem",datasetKey:"heightOfDummyRowItem",legacyKey:"height_of_dummy_row_item",defaultValue:18,parser:S},{key:"repeatHeader",datasetKey:"repeatHeader",legacyKey:"repeat_header",defaultValue:!0,parser:u},{key:"repeatDocinfo",datasetKey:"repeatDocinfo",legacyKey:"repeat_docinfo",defaultValue:!0,parser:u},{key:"repeatDocinfo002",datasetKey:"repeatDocinfo002",legacyKey:"repeat_docinfo002",defaultValue:!0,parser:u},{key:"repeatDocinfo003",datasetKey:"repeatDocinfo003",legacyKey:"repeat_docinfo003",defaultValue:!0,parser:u},{key:"repeatDocinfo004",datasetKey:"repeatDocinfo004",legacyKey:"repeat_docinfo004",defaultValue:!0,parser:u},{key:"repeatDocinfo005",datasetKey:"repeatDocinfo005",legacyKey:"repeat_docinfo005",defaultValue:!0,parser:u},{key:"repeatRowheader",datasetKey:"repeatRowheader",legacyKey:"repeat_rowheader",defaultValue:!0,parser:u},{key:"repeatPtacRowheader",datasetKey:"repeatPtacRowheader",legacyKey:"repeat_ptac_rowheader",defaultValue:!0,parser:u},{key:"repeatFooter",datasetKey:"repeatFooter",legacyKey:"repeat_footer",defaultValue:!1,parser:u},{key:"repeatFooter002",datasetKey:"repeatFooter002",legacyKey:"repeat_footer002",defaultValue:!1,parser:u},{key:"repeatFooter003",datasetKey:"repeatFooter003",legacyKey:"repeat_footer003",defaultValue:!1,parser:u},{key:"repeatFooter004",datasetKey:"repeatFooter004",legacyKey:"repeat_footer004",defaultValue:!1,parser:u},{key:"repeatFooter005",datasetKey:"repeatFooter005",legacyKey:"repeat_footer005",defaultValue:!1,parser:u},{key:"repeatFooterLogo",datasetKey:"repeatFooterLogo",legacyKey:"repeat_footer_logo",defaultValue:!1,parser:u},{key:"repeatFooterPagenum",datasetKey:"repeatFooterPagenum",legacyKey:"repeat_footer_pagenum",defaultValue:!1,parser:u},{key:"fillPageHeightAfterFooter",datasetKey:"fillPageHeightAfterFooter",legacyKey:"fill_page_height_after_footer",defaultValue:!0,parser:u},{key:"insertDummyRowItemWhileFormatTable",datasetKey:"insertDummyRowItemWhileFormatTable",legacyKey:"insert_dummy_row_item_while_format_table",defaultValue:!0,parser:u},{key:"insertPtacDummyRowItems",datasetKey:"insertPtacDummyRowItems",legacyKey:"insert_ptac_dummy_row_items",defaultValue:!0,parser:u},{key:"insertDummyRowWhileFormatTable",datasetKey:"insertDummyRowWhileFormatTable",legacyKey:"insert_dummy_row_while_format_table",defaultValue:!1,parser:u},{key:"insertFooterSpacerWhileFormatTable",datasetKey:"insertFooterSpacerWhileFormatTable",legacyKey:"insert_footer_spacer_while_format_table",defaultValue:!0,parser:u},{key:"insertFooterSpacerWithDummyRowItemWhileFormatTable",datasetKey:"insertFooterSpacerWithDummyRowItemWhileFormatTable",legacyKey:"insert_footer_spacer_with_dummy_row_item_while_format_table",defaultValue:!0,parser:u},{key:"customDummyRowItemContent",datasetKey:"customDummyRowItemContent",legacyKey:"custom_dummy_row_item_content",defaultValue:"",parser:C},{key:"debug",datasetKey:"debug",legacyKey:"debug_printform",defaultValue:!1,parser:u}],te=[{key:"docInfo",className:"pdocinfo",repeatFlag:"repeatDocinfo"},{key:"docInfo002",className:"pdocinfo002",repeatFlag:"repeatDocinfo002"},{key:"docInfo003",className:"pdocinfo003",repeatFlag:"repeatDocinfo003"},{key:"docInfo004",className:"pdocinfo004",repeatFlag:"repeatDocinfo004"},{key:"docInfo005",className:"pdocinfo005",repeatFlag:"repeatDocinfo005"}],I=[{key:"footer",className:"pfooter",repeatFlag:"repeatFooter"},{key:"footer002",className:"pfooter002",repeatFlag:"repeatFooter002"},{key:"footer003",className:"pfooter003",repeatFlag:"repeatFooter003"},{key:"footer004",className:"pfooter004",repeatFlag:"repeatFooter004"},{key:"footer005",className:"pfooter005",repeatFlag:"repeatFooter005"}],D={className:"pfooter_logo"},k={className:"pfooter_pagenum"},_=L.reduce((r,o)=>(r[o.key]=o.defaultValue,r),{});function M(r){const o=typeof window<"u"?window:typeof globalThis<"u"?globalThis:{};return r.reduce((e,t)=>{if(!t.legacyKey)return e;const a=o[t.legacyKey];return a==null||a===""||(e[t.key]=t.parser(a,t.defaultValue)),e},{})}function W(r,o){const e=o||{};return r.reduce((t,a)=>{if(!a.datasetKey||!Object.prototype.hasOwnProperty.call(e,a.datasetKey))return t;const n=e[a.datasetKey];return n==null||n===""||(t[a.key]=a.parser(n,a.defaultValue)),t},{})}function re(){return M(L)}function ae(r){return W(L,r)}function oe(r,o){const e=r.querySelector("template.custom-dummy-row-item-content");return e?e.innerHTML.trim():o}function V(r,o={}){const e=re(),t=ae(r.dataset||{}),a={..._,...e,...t,...o};a.customDummyRowItemContent=oe(r,o.customDummyRowItemContent!==void 0?o.customDummyRowItemContent:a.customDummyRowItemContent),a.debug=u(a.debug,_.debug),a.nUp=S(a.nUp,_.nUp),(!Number.isFinite(a.nUp)||a.nUp<1)&&(a.nUp=_.nUp),a.nUp=Math.floor(a.nUp),a.showLogicalPageNumber=u(a.showLogicalPageNumber,_.showLogicalPageNumber),a.showPhysicalPageNumber=u(a.showPhysicalPageNumber,_.showPhysicalPageNumber),a.papersizeWidth=S(a.papersizeWidth,_.papersizeWidth),a.papersizeHeight=S(a.papersizeHeight,_.papersizeHeight),a.paperSize=C(a.paperSize,_.paperSize),a.orientation=C(a.orientation,_.orientation),a.dpi=S(a.dpi,_.dpi),(!Number.isFinite(a.dpi)||a.dpi<=0)&&(a.dpi=_.dpi);const n=l=>Object.prototype.hasOwnProperty.call(o,l)&&o[l]!=="",i=Object.prototype.hasOwnProperty.call(e,"papersizeWidth")||Object.prototype.hasOwnProperty.call(t,"papersizeWidth")||n("papersizeWidth"),p=Object.prototype.hasOwnProperty.call(e,"papersizeHeight")||Object.prototype.hasOwnProperty.call(t,"papersizeHeight")||n("papersizeHeight");if(!i&&!p){const l=Q({paperSize:a.paperSize,orientation:a.orientation,dpi:a.dpi});l&&(a.papersizeWidth=l.width,a.papersizeHeight=l.height)}return a}const x=[{key:"repeatPaddt",datasetKey:"repeatPaddt",legacyKey:"repeat_paddt",defaultValue:!0,parser:u},{key:"insertPaddtDummyRowItems",datasetKey:"insertPaddtDummyRowItems",legacyKey:"insert_paddt_dummy_row_items",defaultValue:!0,parser:u},{key:"paddtMaxWordsPerSegment",datasetKey:"paddtMaxWordsPerSegment",legacyKey:"paddt_max_words_per_segment",defaultValue:200,parser:S},{key:"repeatPaddtRowheader",datasetKey:"repeatPaddtRowheader",legacyKey:"repeat_paddt_rowheader",defaultValue:!0,parser:u},{key:"paddtDebug",datasetKey:"paddtDebug",legacyKey:"paddt_debug",defaultValue:!1,parser:u},{key:"repeatPaddtDocinfo",datasetKey:"repeatPaddtDocinfo",legacyKey:"repeat_paddt_docinfo",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo002",datasetKey:"repeatPaddtDocinfo002",legacyKey:"repeat_paddt_docinfo002",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo003",datasetKey:"repeatPaddtDocinfo003",legacyKey:"repeat_paddt_docinfo003",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo004",datasetKey:"repeatPaddtDocinfo004",legacyKey:"repeat_paddt_docinfo004",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo005",datasetKey:"repeatPaddtDocinfo005",legacyKey:"repeat_paddt_docinfo005",defaultValue:!0,parser:u}],F=x.reduce(function(r,o){return r[o.key]=o.defaultValue,r},{});function ne(){return M(x)}function ie(r){return W(x,r)}function se(r,o){o=o||{};var e=ne(),t=ie(r&&r.dataset||{}),a={};for(var n in F)Object.prototype.hasOwnProperty.call(F,n)&&(a[n]=F[n]);for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);for(var p in t)Object.prototype.hasOwnProperty.call(t,p)&&(a[p]=t[p]);for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(a[l]=o[l]);return a.paddtDebug=u(a.paddtDebug,F.paddtDebug),a.paddtMaxWordsPerSegment=S(a.paddtMaxWordsPerSegment,F.paddtMaxWordsPerSegment),(!Number.isFinite(a.paddtMaxWordsPerSegment)||a.paddtMaxWordsPerSegment<=0)&&(a.paddtMaxWordsPerSegment=F.paddtMaxWordsPerSegment),a}function z(r,o){const e=document.createElement("table");return e.className="dummy_row",e.setAttribute("width",`${r.papersizeWidth}px`),e.setAttribute("cellspacing","0"),e.setAttribute("cellpadding","0"),e.innerHTML=`<tr style="height:${g(o)}px;"><td style="border:0px solid black;"></td></tr>`,e}function pe(r){const o=document.createElement("table");return o.className="dummy_row_item",o.setAttribute("width",`${r.papersizeWidth}px`),o.setAttribute("cellspacing","0"),o.setAttribute("cellpadding","0"),r.customDummyRowItemContent?o.innerHTML=r.customDummyRowItemContent:o.innerHTML=`<tr style="height:${g(r.heightOfDummyRowItem)}px;"><td style="border:0px solid black;"></td></tr>`,o}function O(r,o,e){const t=g(r.heightOfDummyRowItem),a=g(e);if(t<=0||a<=0)return;const n=Math.floor(a/t);for(let i=0;i<n;i+=1)o.appendChild(pe(r))}function le(r,o,e){const t=g(e);t<=0||o.appendChild(z(r,t))}function ce(r,o,e,t,a){if(!r.insertDummyRowItemWhileFormatTable)return a&&console.log("[printform] applyDummyRowItemsStep: SKIPPED (insertDummyRowItemWhileFormatTable=false)"),g(t);const n=g(e-t);if(a&&(console.log("[printform] applyDummyRowItemsStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   remaining: ${n}px, itemHeight: ${r.heightOfDummyRowItem}px`)),n>0){O(r,o,n);const i=g(r.heightOfDummyRowItem);if(i>0){const p=Math.floor(n/i),l=g(n%i),s=g(e-l);return a&&(console.log(`[printform]   inserted ${p} dummy_row_items (${p} x ${i}px = ${p*i}px)`),console.log(`[printform]   remainder: ${l}px, newHeight: ${s}px`)),s}}return g(t)}function de(r,o,e,t,a){if(!r.insertDummyRowWhileFormatTable)return a&&console.log("[printform] applyDummyRowStep: SKIPPED (insertDummyRowWhileFormatTable=false)"),g(t);const n=g(e-t);return a&&(console.log("[printform] applyDummyRowStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   remaining: ${n}px`)),n>0?(le(r,o,n),a&&console.log(`[printform]   inserted 1 dummy_row with height: ${n}px`),g(t+n)):g(t)}function ue(r,o,e,t,a,n){if(!r.insertFooterSpacerWithDummyRowItemWhileFormatTable||a)return n&&console.log(`[printform] applyFooterSpacerWithDummyStep: SKIPPED (flag=${r.insertFooterSpacerWithDummyRowItemWhileFormatTable}, skipDummy=${a})`),{currentHeight:g(t),skipFooterSpacer:!1};const i=g(e-t);let p=g(t);if(n&&(console.log("[printform] applyFooterSpacerWithDummyStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   remaining: ${i}px`)),i>0){O(r,o,i);const l=g(r.heightOfDummyRowItem);if(l>0){const s=Math.floor(i/l),c=g(i%l);p=g(e-c),n&&console.log(`[printform]   inserted ${s} spacer dummy_row_items, remainder: ${c}px`)}}return{currentHeight:p,skipFooterSpacer:!0}}function fe(r,o,e,t,a,n,i){if(!r.insertFooterSpacerWhileFormatTable){i&&console.log("[printform] applyFooterSpacerStep: SKIPPED (insertFooterSpacerWhileFormatTable=false)");return}const p=n.cloneNode(!0);let l=g(e-t);const s=a&&a.nonRepeating?g(a.nonRepeating):0;s>0&&(l-=s);const c=Math.max(0,l);p.style.height=`${c}px`,o.appendChild(p),i&&(console.log("[printform] applyFooterSpacerStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   nonRepeatingFooter: ${s}px`),console.log(`[printform]   pfooter_spacer height: ${c}px`))}function me(r,o){!r||!o||r.classList.contains(`${o}_processed`)||(r.classList.remove(o),r.classList.add(`${o}_processed`))}function ge(r){if(!r)return 0;const o=r.offsetHeight||r.getBoundingClientRect().height,e=r.ownerDocument&&r.ownerDocument.defaultView||(typeof window<"u"?window:null);if(!e||!e.getComputedStyle)return g(o);const t=e.getComputedStyle(r),a=Number.parseFloat(t.marginTop)||0,n=Number.parseFloat(t.marginBottom)||0;return g(o+a+n)}function he(r){const o=document.createElement("div");o.classList.add("div_page_break_before"),o.setAttribute("style","page-break-before: always; font-size: 0pt; height: 0px;");const e=typeof window<"u"?window:globalThis,t=typeof r=="string"&&r.trim()?r:e&&typeof e.__printFormDividerClassAppend=="string"?e.__printFormDividerClassAppend:"";return t&&t.split(/\s+/).filter(Boolean).forEach(a=>o.classList.add(a)),o}function ye(r,o,e,t){if(!o)return null;const a=o.cloneNode(!0);return r.appendChild(a),e&&e(`append ${t}`),a}function Pe(r,o,e,t,a){if(!o)return;const n=o.cloneNode(!0);r.appendChild(n),e&&e(`append ${a||"prowitem"} ${t}`)}const m={markAsProcessed:me,measureHeight:ge,createPageBreakDivider:he,appendClone:ye,appendRowItem:Pe,createDummyRowTable:z};function we(r){r.prototype.initializeOutputContainer=function(){const e=document.createElement("div");return e.classList.add("printform_formatter"),this.formEl.parentNode.insertBefore(e,this.formEl),e},r.prototype.initializePhysicalWrapper=function(e){this.currentPhysicalWrapper?(e.appendChild(m.createPageBreakDivider()),this.currentPhysicalPage+=1):this.currentPhysicalPage=1;const t=document.createElement("div");return t.classList.add("physical_page_wrapper"),t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start",t.style.width=`${this.config.papersizeWidth}px`,e.appendChild(t),this.currentPhysicalWrapper=t,this.pagesInCurrentPhysical=0,t},r.prototype.ensureCurrentPageContainer=function(e){return this.currentPhysicalWrapper||this.initializePhysicalWrapper(e),this.currentPageContainer||this.createNewLogicalPage(e),this.currentPageContainer},r.prototype.createNewLogicalPage=function(e){(!this.currentPhysicalWrapper||this.pagesInCurrentPhysical>=this.nUp)&&this.initializePhysicalWrapper(e);const t=document.createElement("div");return t.classList.add("printform_page"),t.style.width=`${this.config.papersizeWidth}px`,this.currentPhysicalWrapper.appendChild(t),this.currentPageContainer=t,this.pagesInCurrentPhysical+=1,this.logicalPageToPhysicalPage[this.currentPage]=this.currentPhysicalPage,t},r.prototype.getCurrentPageContainer=function(e){return this.ensureCurrentPageContainer(e)},r.prototype.finalizePageHeight=function(e){if(!e)return;const t=this.config.papersizeHeight,a=this.config.fillPageHeightAfterFooter!==!1;let n=0;if(a){const i=m.measureHeight(e),p=Math.max(0,t-i);if(p>0){const l=m.createDummyRowTable(this.config,p);l.classList.add("dummy_spacer");const s=I.map(d=>`.${d.className}_processed`).concat([`.${D.className}_processed`,`.${k.className}_processed`]),c=e.querySelector(s.join(", "));c&&c.parentNode===e?e.insertBefore(l,c):e.appendChild(l),n=p}}if(this.debug){console.log(`
[printform] ========== PAGE HEIGHT CALCULATION ==========`),console.log(`[printform] Configured page height: ${t}px`),console.log("[printform] -------------------------------------------");const i=Array.from(e.children);let p=0;if(console.log(`[printform] Elements breakdown (${i.length} elements):`),i.forEach((l,s)=>{const c=m.measureHeight(l);p+=c;const d=l.className||"(no class)",f=l.tagName.toLowerCase();console.log(`[printform]   ${s+1}. <${f}.${d}>`),console.log(`[printform]      Height: ${c}px`),console.log(`[printform]      Cumulative: ${p}px`),console.log(`[printform]      Remaining: ${Math.max(0,t-p)}px`),c>t*.5&&console.log("[printform]      ⚠️  WARNING: Element height is > 50% of page height")}),console.log("[printform] -------------------------------------------"),console.log(`[printform] Total content height: ${p}px`),p<t){const l=t-p;console.log(`[printform] ✓ Content fits (${l}px under limit)`)}else if(p>t){const l=p-t;console.log(`[printform] ⚠️  Content overflow (${l}px over limit)`)}else console.log("[printform] ✓ Perfect fit (exactly matches configured height)");n>0&&console.log(`[printform] ✓ Final spacer appended: ${n}px`)}if(this.debug){const i=m.measureHeight(e);console.log("[printform] -------------------------------------------"),console.log(`[printform] Actual measured height: ${i}px`),console.log("[printform] ℹ️  Height NOT set - using natural content height"),console.log(`[printform] ===============================================
`)}}}const _e=".prowitem, .ptac-rowitem, .paddt-rowitem",be=200,Se=200;function Ne(r){return r&&r.nodeType===3}function Re(r){return r&&r.nodeType===1}function v(r,o,e){if(o===e)return r;const t=[];let a=o;for(;a&&a!==e;)t.unshift(a),a=a.parentNode;let n=r;return t.forEach(i=>{let p=n.lastElementChild;if(!p||p.tagName!==i.tagName){const l=i.cloneNode(!1);n.appendChild(l),n=l}else n=p}),n}function B(r,o){if(!r)return[];const e=(r.textContent||"").trim();if(!e)return[r.outerHTML||""];if(e.split(/\s+/).filter(l=>l).length<=o)return[r.outerHTML];const a=[];let n=r.cloneNode(!1),i=0;function p(l){if(Ne(l)){const c=l.textContent.split(/(\s+)/);let d="";c.forEach(f=>{if(!f.trim()){d+=f;return}i>=o&&(d&&(v(n,l.parentNode,r).appendChild(document.createTextNode(d)),d=""),a.push(n.outerHTML),n=r.cloneNode(!1),i=0),d+=f,i++}),d&&v(n,l.parentNode,r).appendChild(document.createTextNode(d))}else Re(l)&&l.childNodes.forEach(s=>p(s))}return p(r),n.innerHTML.trim()&&a.push(n.outerHTML),a}function Fe(r,o){return B(r,o)}function Ce(r){r.prototype.collectSections=function(){this.expandPaddtSegments(),this.expandPtacSegments();const e=te.map(p=>{const l=this.formEl.querySelector(`.${p.className}`);return l?{key:p.key,className:p.className,repeatFlag:p.repeatFlag,element:l}:null}).filter(Boolean),t=I.map(p=>{const l=this.formEl.querySelector(`.${p.className}`);return l?{key:p.key,className:p.className,repeatFlag:p.repeatFlag,element:l}:null}).filter(Boolean),a=Array.from(this.formEl.querySelectorAll(_e)),n=a.filter(p=>this.isPaddtRow(p)),i=a.filter(p=>!this.isPaddtRow(p));return this.paddtRows=n,{header:this.formEl.querySelector(".pheader"),docInfos:e,rowHeader:this.formEl.querySelector(".prowheader"),footerVariants:t,footerLogo:this.formEl.querySelector(`.${D.className}`),footerPagenum:this.formEl.querySelector(`.${k.className}`),rows:i}},r.prototype.measureSections=function(e){const t={header:m.measureHeight(e.header),docInfos:{},rowHeader:m.measureHeight(e.rowHeader),footerVariants:{},footerLogo:m.measureHeight(e.footerLogo),footerPagenum:m.measureHeight(e.footerPagenum)};return e.docInfos.forEach(a=>{t.docInfos[a.key]=m.measureHeight(a.element)}),e.footerVariants.forEach(a=>{t.footerVariants[a.key]=m.measureHeight(a.element)}),t},r.prototype.markSectionsProcessed=function(e){m.markAsProcessed(e.header,"pheader"),e.docInfos.forEach(t=>{m.markAsProcessed(t.element,t.className)}),m.markAsProcessed(e.rowHeader,"prowheader"),e.footerVariants.forEach(t=>{m.markAsProcessed(t.element,t.className)}),m.markAsProcessed(e.footerLogo,D.className),m.markAsProcessed(e.footerPagenum,k.className)},r.prototype.createFooterSpacerTemplate=function(){const e=document.createElement("div");return e.classList.add("pfooter_spacer","paper_width"),e.style.height="0px",e}}function De(r){r.prototype.isPaddtRow=function(e){return e?e.classList.contains("paddt_segment")||e.classList.contains("paddt")||e.classList.contains("paddt-rowitem")||e.classList.contains("paddt-rowitem_processed"):!1},r.prototype.isPtacRow=function(e){return e?e.classList.contains("ptac_segment")||e.classList.contains("ptac")||e.classList.contains("ptac-rowitem")||e.classList.contains("ptac-rowitem_processed"):!1},r.prototype.getRowBaseClass=function(e){return e?this.isPaddtRow(e)?"paddt-rowitem":this.isPtacRow(e)?"ptac-rowitem":"prowitem":"prowitem"},r.prototype.shouldSkipRowHeaderForRow=function(e){return!e||!this.config.repeatRowheader?!1:e.classList.contains("without_prowheader")||e.classList.contains("tb_without_rowheader")?!0:this.isPtacRow(e)?!this.config.repeatPtacRowheader:this.isPaddtRow(e)?!(this.paddtConfig&&this.paddtConfig.repeatPaddtRowheader):!1},r.prototype.shouldSkipDummyRowItemsForContext=function(e){return!!(e&&(e.isPtacPage&&!this.config.insertPtacDummyRowItems||e.isPaddtPage&&!(this.paddtConfig&&this.paddtConfig.insertPaddtDummyRowItems)))}}function He(r){r.prototype.expandPaddtSegments=function(){if(this.formEl.dataset.paddtExpanded==="true")return;const e=Array.from(this.formEl.querySelectorAll(".paddt"));if(e.length===0){this.formEl.dataset.paddtExpanded="true";return}var t=this.paddtConfig&&this.paddtConfig.paddtMaxWordsPerSegment||Se;e.forEach(a=>{if(!a||a.dataset.paddtSegment==="true")return;const n=a.querySelector("td > div")||a.querySelector("td");if(!n){a.classList.add("paddt-rowitem","paddt_segment"),a.dataset.paddtSegment="true";return}const i=Array.from(n.querySelectorAll("p"));var p=null;i.length>1&&(p=i.shift());const l=i;if(l.length===0){a.classList.add("paddt-rowitem","paddt_segment"),a.dataset.paddtSegment="true";return}const s=p?p.outerHTML:"",c=l.reduce(function(P,w){const H=Fe(w,t);return P.concat(H)},[]);if(c.length===0){n.innerHTML=s,a.classList.add("paddt-rowitem","paddt_segment"),a.dataset.paddtSegment="true";return}const d=[];if(s){d.push(s+c[0]);for(var f=1;f<c.length;f+=1)d.push(c[f])}else for(var h=0;h<c.length;h+=1)d.push(c[h]);if(d.length===0){n.innerHTML=s,a.classList.add("paddt-rowitem","paddt_segment"),a.dataset.paddtSegment="true";return}n.innerHTML=d[0],a.classList.add("paddt-rowitem","paddt_segment"),a.dataset.paddtSegment="true";for(var y=a,b=1;b<d.length;b+=1){const P=a.cloneNode(!0);P.dataset.paddtSegment="true";const w=P.querySelector("td > div")||P.querySelector("td");w&&(w.innerHTML=d[b]),y.parentNode.insertBefore(P,y.nextSibling),y=P}}),this.formEl.dataset.paddtExpanded="true"}}function ke(r){r.prototype.expandPtacSegments=function(){if(this.formEl.dataset.ptacExpanded==="true")return;const e=Array.from(this.formEl.querySelectorAll(".ptac"));if(e.length===0){this.formEl.dataset.ptacExpanded="true";return}e.forEach(t=>{if(!t||t.dataset.ptacSegment==="true")return;const a=t.querySelector("td > div")||t.querySelector("td");if(!a){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}const n=Array.from(a.children);if(n.length===0){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}const i=[];if(n.forEach(s=>{s.tagName.toLowerCase()==="p"?B(s,be).forEach(d=>i.push(d)):i.push(s.outerHTML)}),i.length===0){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}a.innerHTML=i[0],t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";for(var p=t,l=1;l<i.length;l+=1){const s=t.cloneNode(!0);s.classList.remove("tb_page_break_before"),s.dataset.ptacSegment="true";const c=s.querySelector("td > div")||s.querySelector("td");c&&(c.innerHTML=i[l]),p.parentNode.insertBefore(s,p.nextSibling),p=s}}),this.formEl.dataset.ptacExpanded="true"}}function Le(r){r.prototype.ensureFirstPageSections=function(e,t,a,n,i){let p=0;return t.header&&(m.appendClone(e,t.header,n,"pheader"),this.config.repeatHeader||(p+=a.header)),t.docInfos.forEach(l=>{const s=m.appendClone(e,l.element,n,l.className);this.registerPageNumberClone(s),this.config[l.repeatFlag]||(p+=a.docInfos[l.key]||0)}),t.rowHeader&&!i&&(m.appendClone(e,t.rowHeader,n,"prowheader"),this.config.repeatRowheader||(p+=a.rowHeader)),p},r.prototype.appendRepeatingSections=function(e,t,a,n){this.config.repeatHeader&&m.appendClone(e,t.header,a,"pheader"),t.docInfos.forEach(i=>{if(this.config[i.repeatFlag]){const p=m.appendClone(e,i.element,a,i.className);this.registerPageNumberClone(p)}}),this.config.repeatRowheader&&!n&&m.appendClone(e,t.rowHeader,a,"prowheader")},r.prototype.registerPageNumberClone=function(e){if(!e)return!1;let t=!1;if(this.showLogicalPageNumber&&e.querySelector("[data-page-number], [data-page-total], [data-page-number-container]")&&(K(e,this.currentPage,null),this.logicalPageNumberClones.push({node:e,pageNumber:this.currentPage}),t=!0),this.showPhysicalPageNumber&&e.querySelector("[data-physical-page-number], [data-physical-page-total], [data-physical-page-number-container]")){const a=this.logicalPageToPhysicalPage[this.currentPage]||this.currentPhysicalPage||1;A(e,a,null),this.physicalPageNumberClones.push({node:e,pageNumber:a}),t=!0}return t},r.prototype.appendRepeatingFooters=function(e,t,a){t.footerVariants.forEach(n=>{this.config[n.repeatFlag]&&m.appendClone(e,n.element,a,n.className)}),this.config.repeatFooterLogo&&m.appendClone(e,t.footerLogo,a,D.className),this.config.repeatFooterPagenum&&this.appendFooterPageNumber(e,t,a)},r.prototype.appendFinalFooters=function(e,t,a){t.footerVariants.forEach(n=>{m.appendClone(e,n.element,a,n.className)}),m.appendClone(e,t.footerLogo,a,D.className),this.appendFooterPageNumber(e,t,a)},r.prototype.appendFooterPageNumber=function(e,t,a){if(!t.footerPagenum)return;const n=t.footerPagenum.cloneNode(!0);e.appendChild(n),this.registerPageNumberClone(n),a&&a(`append ${k.className} page ${this.currentPage}`)},r.prototype.updatePageNumberTotals=function(){if(!this.logicalPageNumberClones.length&&!this.physicalPageNumberClones.length)return;const e=this.currentPage,t=this.currentPhysicalPage||1;this.logicalPageNumberClones.forEach(a=>{K(a.node,a.pageNumber,e)}),this.physicalPageNumberClones.forEach(a=>{A(a.node,a.pageNumber,t)})}}function xe(r){r.prototype.initializePageContext=function(e){return{baseLimit:e,limit:e,skipRowHeader:!1,isPtacPage:!1,isPaddtPage:!1}},r.prototype.refreshPageContextForRow=function(e,t,a){if(!e)return e;const n=this.shouldSkipRowHeaderForRow(t),i=a.rowHeader||0;return e.skipRowHeader=n,e.isPtacPage=this.isPtacRow(t),e.isPaddtPage=this.isPaddtRow(t),e.limit=e.baseLimit+(n?i:0),e},r.prototype.renderRows=function(e,t,a,n,i,p,l){let s=0;const c=this.initializePageContext(i);return this.debug&&(console.log("[printform] ===== renderRows START ====="),console.log(`[printform] Total rows: ${t.rows.length}, heightPerPage: ${i}px`)),t.rows.forEach((d,f)=>{const h=m.measureHeight(d),y=this.getRowBaseClass(d),b=this.isPtacRow(d),P=this.isPaddtRow(d);if(!h){m.markAsProcessed(d,y);return}if(s===0){this.refreshPageContextForRow(c,d,a);const w=this.getCurrentPageContainer(e);s+=this.ensureFirstPageSections(w,t,a,l,c.skipRowHeader),this.debug&&console.log(`[printform] Page ${this.currentPage} start: firstSectionHeight=${s}px, pageLimit=${c.limit}px`)}if(s+=h,this.debug&&console.log(`[printform]   row[${f}] height=${h}px, currentHeight=${s}px, limit=${c.limit}px`),m.markAsProcessed(d,y),d.classList.contains("tb_page_break_before")){this.debug&&console.log(`[printform]   >> PAGE BREAK (tb_page_break_before) at row[${f}]`),s-=h;const w=this.shouldSkipDummyRowItemsForContext(c),H=this.shouldSkipRowHeaderForRow(d);s=this.prepareNextPage(e,t,l,c.limit,s,n,p,H,w),this.refreshPageContextForRow(c,d,a);const T=this.getCurrentPageContainer(e);m.appendRowItem(T,d,l,f,y),s=h,this.debug&&console.log(`[printform] Page ${this.currentPage} start: currentHeight=${s}px, limit=${c.limit}px`),b||(c.isPtacPage=!1),P||(c.isPaddtPage=!1)}else if(s<=c.limit){const w=this.getCurrentPageContainer(e);m.appendRowItem(w,d,l,f,y),b||(c.isPtacPage=!1),P||(c.isPaddtPage=!1)}else{s-=h,this.debug&&console.log(`[printform]   >> PAGE BREAK (overflow) at row[${f}]`);const w=this.shouldSkipDummyRowItemsForContext(c),H=this.shouldSkipRowHeaderForRow(d);s=this.prepareNextPage(e,t,l,c.limit,s,n,p,H,w),this.refreshPageContextForRow(c,d,a);const T=this.getCurrentPageContainer(e);m.appendRowItem(T,d,l,f,y),s=h,this.debug&&console.log(`[printform] Page ${this.currentPage} start: currentHeight=${s}px, limit=${c.limit}px`),b||(c.isPtacPage=!1),P||(c.isPaddtPage=!1)}}),this.debug&&console.log(`[printform] ===== renderRows END (page ${this.currentPage}, finalHeight=${s}px) =====`),{currentHeight:s,pageLimit:c.limit,isPtacPage:c.isPtacPage,isPaddtPage:c.isPaddtPage}},r.prototype.prepareNextPage=function(e,t,a,n,i,p,l,s,c){const d=this.getCurrentPageContainer(e),f=this.applyRemainderSpacing(d,n,i,p,l,{skipDummyRowItems:c});this.appendRepeatingFooters(d,t,a),this.currentPage+=1,this.currentPageContainer=null,this.createNewLogicalPage(e);const h=this.getCurrentPageContainer(e);return this.appendRepeatingSections(h,t,a,s),f},r.prototype.applyRemainderSpacing=function(e,t,a,n,i,p){const l=p&&p.skipDummyRowItems;let s=g(a);this.debug&&(console.log(`[printform] ----- applyRemainderSpacing (page ${this.currentPage}) -----`),console.log(`[printform]   heightPerPage: ${t}px, currentHeight: ${a}px`),console.log(`[printform]   skipDummyRowItems: ${l}`)),l||(s=ce(this.config,e,t,s,this.debug)),s=de(this.config,e,t,s,this.debug);const c=ue(this.config,e,t,s,l,this.debug);return s=c.currentHeight,c.skipFooterSpacer||fe(this.config,e,t,s,n,i,this.debug),this.debug&&(console.log(`[printform]   finalHeight after spacing: ${s}px`),console.log("[printform] -----------------------------------------")),g(s)}}function Ee(r){r.prototype.computeHeightPerPage=function(e,t){let a=this.config.papersizeHeight;if(this.debug&&(console.log("[printform] ===== computeHeightPerPage ====="),console.log(`[printform] papersizeHeight (config): ${this.config.papersizeHeight}px`),console.log(`[printform] papersizeWidth (config): ${this.config.papersizeWidth}px`)),this.config.repeatHeader&&e.header&&(this.debug&&console.log(`[printform]   - repeatHeader: ${t.header}px`),a-=t.header),e.docInfos.forEach(n=>{if(this.config[n.repeatFlag]){const i=t.docInfos[n.key]||0;this.debug&&console.log(`[printform]   - repeat ${n.className}: ${i}px`),a-=i}}),this.config.repeatRowheader&&e.rowHeader&&(this.debug&&console.log(`[printform]   - repeatRowheader: ${t.rowHeader}px`),a-=t.rowHeader),e.footerVariants.forEach(n=>{if(this.config[n.repeatFlag]){const i=t.footerVariants[n.key]||0;this.debug&&console.log(`[printform]   - repeat ${n.className}: ${i}px`),a-=i}}),this.config.repeatFooterLogo&&e.footerLogo&&(this.debug&&console.log(`[printform]   - repeatFooterLogo: ${t.footerLogo}px`),a-=t.footerLogo),this.config.repeatFooterPagenum&&e.footerPagenum){const n=t.footerPagenum||0;this.debug&&console.log(`[printform]   - repeatFooterPagenum: ${n}px`),a-=n}return this.debug&&(console.log(`[printform] heightPerPage (available for content): ${Math.max(0,a)}px`),console.log("[printform] ================================")),Math.max(0,a)},r.prototype.computeFooterState=function(e,t){const a=t.footerLogo||0,n=t.footerPagenum||0,p=e.footerVariants.reduce((d,f)=>{const h=t.footerVariants[f.key]||0;return d+h},0)+a+n;let s=e.footerVariants.reduce((d,f)=>{const h=t.footerVariants[f.key]||0;return this.config[f.repeatFlag]?d+h:d},0);this.config.repeatFooterLogo&&(s+=a),this.config.repeatFooterPagenum&&(s+=n);const c=Math.max(0,p-s);return{totalFinal:p,repeating:s,nonRepeating:c}},r.prototype.finalizeDocument=function(e,t,a,n,i,p,l){const s=i?i.currentHeight:0,c=i&&i.pageLimit?i.pageLimit:n,d=!!(i&&(i.isPtacPage&&!this.config.insertPtacDummyRowItems||i.isPaddtPage&&!(this.paddtConfig&&this.paddtConfig.insertPaddtDummyRowItems))),f=a.totalFinal-a.repeating,h=s+f;if(h<=c){const P=this.getCurrentPageContainer(e);this.applyRemainderSpacing(P,c,h,a,p,{skipDummyRowItems:d}),this.appendFinalFooters(P,t,l);return}this.prepareNextPage(e,t,l,c,s,a,p,!1,d);const y=f,b=this.getCurrentPageContainer(e);this.applyRemainderSpacing(b,n,y,a,p,null),this.appendFinalFooters(b,t,l)}}class N{constructor(o,e){this.formEl=o,this.config=e,this.debug=!!e.debug,this.nUp=Math.max(1,Math.floor(Number(e.nUp||1))),this.showLogicalPageNumber=e.showLogicalPageNumber!==!1,this.showPhysicalPageNumber=!!e.showPhysicalPageNumber,this.paddtConfig=se(o,{}),this.paddtDebug=!!this.paddtConfig.paddtDebug,this.currentPage=1,this.currentPhysicalPage=0,this.pagesInCurrentPhysical=0,this.currentPhysicalWrapper=null,this.currentPageContainer=null,this.logicalPageNumberClones=[],this.physicalPageNumberClones=[],this.logicalPageToPhysicalPage=[],this.debug&&(console.log("[printform] ===== PrintFormFormatter initialized ====="),console.log("[printform] debug mode: ON"),console.log(`[printform] config.debug raw value: ${e.debug}`))}log(o){this.debug&&console.log(`[printform] ${o}`)}format(){const o=this.debug?this.log.bind(this):null,e=this.initializeOutputContainer();this.ensureCurrentPageContainer(e);const t=this.collectSections(),a=this.measureSections(t),n=this.createFooterSpacerTemplate();this.markSectionsProcessed(t);const i=this.computeFooterState(t,a),p=this.computeHeightPerPage(t,a),l=this.renderRows(e,t,a,i,p,n,o);if(this.finalizeDocument(e,t,i,p,l,n,o),this.paddtRows&&this.paddtRows.length){this.currentPage+=1,this.currentPageContainer=null,this.initializePhysicalWrapper(e),this.createNewLogicalPage(e);var s={docInfo:this.paddtConfig.repeatPaddtDocinfo,docInfo002:this.paddtConfig.repeatPaddtDocinfo002,docInfo003:this.paddtConfig.repeatPaddtDocinfo003,docInfo004:this.paddtConfig.repeatPaddtDocinfo004,docInfo005:this.paddtConfig.repeatPaddtDocinfo005},c=t.docInfos.filter(function(P){var w=s[P.key];return w===void 0?!0:!!w});const f={header:t.header,docInfos:c,rowHeader:t.rowHeader,footerVariants:[],footerLogo:t.footerLogo,footerPagenum:t.footerPagenum,rows:this.paddtRows},h=this.computeFooterState(f,a),y=this.computeHeightPerPage(f,a),b=this.renderRows(e,f,a,h,y,n,o);this.finalizeDocument(e,f,h,y,b,n,o)}this.updatePageNumberTotals();const d=e.querySelectorAll(".printform_page");return this.debug&&console.log(`[printform] Finalizing heights for ${d.length} pages...`),d.forEach((f,h)=>{if(this.finalizePageHeight(f),this.debug){const y=f.style.height||"(auto)";console.log(`[printform]   Page ${h+1}: height style = ${y}`)}}),e.classList.remove("printform_formatter"),e.classList.add("printform_formatter_processed"),this.formEl.remove(),e}}we(N),Ce(N),De(N),He(N),ke(N),Le(N),xe(N),Ee(N);function q(r,o,e){const t=r.__printFormDividerClassAppend;r.__printFormDividerClassAppend=typeof o=="string"?o:"";try{return e()}finally{t===void 0?delete r.__printFormDividerClassAppend:r.__printFormDividerClassAppend=t}}function Te(r){return new Promise((o,e)=>{setTimeout(o,r)})}async function U(r={}){const o=typeof window<"u"?window:globalThis;if(!o.__printFormProcessing&&!(!r.force&&o.__printFormProcessed)){o.__printFormProcessing=!0;try{const e=o.document;if(!e)return;const t=Array.from(e.querySelectorAll(".printform"));for(let a=0;a<t.length;a+=1){const n=t[a],i={...r};if(i.divPageBreakBeforeClassAppend===void 0&&n&&n.dataset){const s=n.dataset.divPageBreakBeforeClassAppend;typeof s=="string"&&s.trim()&&(i.divPageBreakBeforeClassAppend=s.trim())}const p=i.divPageBreakBeforeClassAppend,l=V(n,i);try{await Te(1)}catch(s){console.error("pauseInMilliseconds error",s)}try{const s=q(o,p,()=>new N(n,l).format());a>0&&s&&s.parentNode&&s.parentNode.insertBefore(m.createPageBreakDivider(p),s)}catch(s){console.error("printform format error",s)}}o.__printFormProcessed=!0}finally{o.__printFormProcessing=!1}}}function $e(r,o={}){const e=typeof window<"u"?window:globalThis,t={...o};if(t.divPageBreakBeforeClassAppend===void 0&&r&&r.dataset){const i=r.dataset.divPageBreakBeforeClassAppend;typeof i=="string"&&i.trim()&&(t.divPageBreakBeforeClassAppend=i.trim())}const a=t.divPageBreakBeforeClassAppend,n=V(r,t);return q(e,a,()=>new N(r,n).format())}const E={formatAll:U,format:$e,DEFAULT_CONFIG:_,DEFAULT_PADDT_CONFIG:F},R=typeof window<"u"?window:null;if(R)if(R.__printFormScriptLoaded__)R.PrintForm=R.PrintForm||E;else{R.__printFormScriptLoaded__=!0,R.PrintForm=R.PrintForm||{},Object.assign(R.PrintForm,E);const r=R.document;r&&r.addEventListener&&r.addEventListener("DOMContentLoaded",()=>{U()})}return E}();
