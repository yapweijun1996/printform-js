var PrintForm=function(){"use strict";const q=new Set(["y","yes","true","1"]),U=new Set(["n","no","false","0"]);function u(a,o){if(a==null||a==="")return o;if(typeof a=="boolean")return a;if(typeof a=="number")return a!==0;const e=String(a).trim().toLowerCase();return q.has(e)?!0:U.has(e)?!1:o}function S(a,o){if(a==null||a==="")return o;const e=Number(a);return Number.isFinite(e)?e:o}function D(a,o){return a==null||a===""?o:String(a)}function G(a){const o=String(a||"").trim().toLowerCase();return o==="landscape"?"landscape":o==="portrait"?"portrait":""}function j(a){const o=String(a||"").trim();if(!o)return"";const e=o.toUpperCase();return e==="A4"||e==="A5"||e==="LETTER"||e==="LEGAL"?e:e==="US_LETTER"||e==="USLETTER"?"LETTER":e==="US_LEGAL"||e==="USLEGAL"?"LEGAL":""}function T(a,o){const e=Number(a),t=Number(o);return!Number.isFinite(e)||!Number.isFinite(t)||t<=0?0:Math.round(e/25.4*t)}const X={A4:{widthMm:210,heightMm:297},A5:{widthMm:148,heightMm:210},LETTER:{widthMm:215.9,heightMm:279.4},LEGAL:{widthMm:215.9,heightMm:355.6}};function Z(a){const o=j(a&&a.paperSize);if(!o)return null;const e=X[o];if(!e)return null;const t=Number(a&&a.dpi),r=T(e.widthMm,t),n=T(e.heightMm,t);return!r||!n?null:(G(a&&a.orientation)||"portrait")==="landscape"?{width:n,height:r}:{width:r,height:n}}function m(a){const o=Number(a);return Number.isFinite(o)?Math.max(0,Math.round(o)):0}function J(a){if(!a)return null;if(a.__pageNumberPlaceholder)return a.__pageNumberPlaceholder;const o=a.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;let e=a.querySelector("[data-page-number-container]");e||(e=a.querySelector("td:last-child")||a.querySelector("td")||a);const t=o.createElement("span");return t.className="printform_page_number_placeholder",e.appendChild(t),a.__pageNumberPlaceholder=t,t}function Q(a){if(!a)return null;if(a.__physicalPageNumberPlaceholder)return a.__physicalPageNumberPlaceholder;const o=a.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;let e=a.querySelector("[data-physical-page-number-container]");e||(e=a.querySelector("td:last-child")||a.querySelector("td")||a);const t=o.createElement("span");return t.className="printform_physical_page_number_placeholder",e.appendChild(t),a.__physicalPageNumberPlaceholder=t,t}function K(a,o,e){if(!a)return;const t=a.querySelectorAll("[data-page-number]");t.length>0&&t.forEach(function(i){i.textContent=o});const r=a.querySelectorAll("[data-page-total]"),n=e??"";if(r.length>0&&r.forEach(function(i){i.textContent=n}),t.length===0&&r.length===0){const i=J(a);i&&(i.textContent=e!=null?"Page "+o+" of "+e:"Page "+o)}}function A(a,o,e){if(!a)return;const t=a.querySelectorAll("[data-physical-page-number]");t.length>0&&t.forEach(function(i){i.textContent=o});const r=a.querySelectorAll("[data-physical-page-total]"),n=e??"";if(r.length>0&&r.forEach(function(i){i.textContent=n}),t.length===0&&r.length===0){const i=Q(a);i&&(i.textContent=e!=null?"Sheet "+o+" of "+e:"Sheet "+o)}}const L=[{key:"papersizeWidth",datasetKey:"papersizeWidth",legacyKey:"papersize_width",defaultValue:750,parser:S},{key:"papersizeHeight",datasetKey:"papersizeHeight",legacyKey:"papersize_height",defaultValue:1050,parser:S},{key:"enforcePageHeight",datasetKey:"enforcePageHeight",legacyKey:"enforce_page_height",defaultValue:!0,parser:u},{key:"paperSize",datasetKey:"paperSize",legacyKey:"paper_size",defaultValue:"",parser:D},{key:"orientation",datasetKey:"orientation",legacyKey:"orientation",defaultValue:"portrait",parser:D},{key:"dpi",datasetKey:"dpi",legacyKey:"dpi",defaultValue:96,parser:S},{key:"nUp",datasetKey:"nUp",legacyKey:"n_up",defaultValue:1,parser:S},{key:"showLogicalPageNumber",datasetKey:"showLogicalPageNumber",legacyKey:"show_logical_page_number",defaultValue:!0,parser:u},{key:"showPhysicalPageNumber",datasetKey:"showPhysicalPageNumber",legacyKey:"show_physical_page_number",defaultValue:!1,parser:u},{key:"heightOfDummyRowItem",datasetKey:"heightOfDummyRowItem",legacyKey:"height_of_dummy_row_item",defaultValue:18,parser:S},{key:"repeatHeader",datasetKey:"repeatHeader",legacyKey:"repeat_header",defaultValue:!0,parser:u},{key:"repeatDocinfo",datasetKey:"repeatDocinfo",legacyKey:"repeat_docinfo",defaultValue:!0,parser:u},{key:"repeatDocinfo002",datasetKey:"repeatDocinfo002",legacyKey:"repeat_docinfo002",defaultValue:!0,parser:u},{key:"repeatDocinfo003",datasetKey:"repeatDocinfo003",legacyKey:"repeat_docinfo003",defaultValue:!0,parser:u},{key:"repeatDocinfo004",datasetKey:"repeatDocinfo004",legacyKey:"repeat_docinfo004",defaultValue:!0,parser:u},{key:"repeatDocinfo005",datasetKey:"repeatDocinfo005",legacyKey:"repeat_docinfo005",defaultValue:!0,parser:u},{key:"repeatRowheader",datasetKey:"repeatRowheader",legacyKey:"repeat_rowheader",defaultValue:!0,parser:u},{key:"repeatPtacRowheader",datasetKey:"repeatPtacRowheader",legacyKey:"repeat_ptac_rowheader",defaultValue:!0,parser:u},{key:"repeatFooter",datasetKey:"repeatFooter",legacyKey:"repeat_footer",defaultValue:!1,parser:u},{key:"repeatFooter002",datasetKey:"repeatFooter002",legacyKey:"repeat_footer002",defaultValue:!1,parser:u},{key:"repeatFooter003",datasetKey:"repeatFooter003",legacyKey:"repeat_footer003",defaultValue:!1,parser:u},{key:"repeatFooter004",datasetKey:"repeatFooter004",legacyKey:"repeat_footer004",defaultValue:!1,parser:u},{key:"repeatFooter005",datasetKey:"repeatFooter005",legacyKey:"repeat_footer005",defaultValue:!1,parser:u},{key:"repeatFooterLogo",datasetKey:"repeatFooterLogo",legacyKey:"repeat_footer_logo",defaultValue:!1,parser:u},{key:"repeatFooterPagenum",datasetKey:"repeatFooterPagenum",legacyKey:"repeat_footer_pagenum",defaultValue:!1,parser:u},{key:"insertDummyRowItemWhileFormatTable",datasetKey:"insertDummyRowItemWhileFormatTable",legacyKey:"insert_dummy_row_item_while_format_table",defaultValue:!0,parser:u},{key:"insertPtacDummyRowItems",datasetKey:"insertPtacDummyRowItems",legacyKey:"insert_ptac_dummy_row_items",defaultValue:!0,parser:u},{key:"insertDummyRowWhileFormatTable",datasetKey:"insertDummyRowWhileFormatTable",legacyKey:"insert_dummy_row_while_format_table",defaultValue:!1,parser:u},{key:"insertFooterSpacerWhileFormatTable",datasetKey:"insertFooterSpacerWhileFormatTable",legacyKey:"insert_footer_spacer_while_format_table",defaultValue:!0,parser:u},{key:"insertFooterSpacerWithDummyRowItemWhileFormatTable",datasetKey:"insertFooterSpacerWithDummyRowItemWhileFormatTable",legacyKey:"insert_footer_spacer_with_dummy_row_item_while_format_table",defaultValue:!0,parser:u},{key:"customDummyRowItemContent",datasetKey:"customDummyRowItemContent",legacyKey:"custom_dummy_row_item_content",defaultValue:"",parser:D},{key:"debug",datasetKey:"debug",legacyKey:"debug_printform",defaultValue:!1,parser:u}],Y=[{key:"docInfo",className:"pdocinfo",repeatFlag:"repeatDocinfo"},{key:"docInfo002",className:"pdocinfo002",repeatFlag:"repeatDocinfo002"},{key:"docInfo003",className:"pdocinfo003",repeatFlag:"repeatDocinfo003"},{key:"docInfo004",className:"pdocinfo004",repeatFlag:"repeatDocinfo004"},{key:"docInfo005",className:"pdocinfo005",repeatFlag:"repeatDocinfo005"}],ee=[{key:"footer",className:"pfooter",repeatFlag:"repeatFooter"},{key:"footer002",className:"pfooter002",repeatFlag:"repeatFooter002"},{key:"footer003",className:"pfooter003",repeatFlag:"repeatFooter003"},{key:"footer004",className:"pfooter004",repeatFlag:"repeatFooter004"},{key:"footer005",className:"pfooter005",repeatFlag:"repeatFooter005"}],H={className:"pfooter_logo"},k={className:"pfooter_pagenum"},_=L.reduce((a,o)=>(a[o.key]=o.defaultValue,a),{});function I(a){const o=typeof window<"u"?window:typeof globalThis<"u"?globalThis:{};return a.reduce((e,t)=>{if(!t.legacyKey)return e;const r=o[t.legacyKey];return r==null||r===""||(e[t.key]=t.parser(r,t.defaultValue)),e},{})}function M(a,o){const e=o||{};return a.reduce((t,r)=>{if(!r.datasetKey||!Object.prototype.hasOwnProperty.call(e,r.datasetKey))return t;const n=e[r.datasetKey];return n==null||n===""||(t[r.key]=r.parser(n,r.defaultValue)),t},{})}function te(){return I(L)}function re(a){return M(L,a)}function ae(a,o){const e=a.querySelector("template.custom-dummy-row-item-content");return e?e.innerHTML.trim():o}function V(a,o={}){const e=te(),t=re(a.dataset||{}),r={..._,...e,...t,...o};r.customDummyRowItemContent=ae(a,o.customDummyRowItemContent!==void 0?o.customDummyRowItemContent:r.customDummyRowItemContent),r.debug=u(r.debug,_.debug),r.nUp=S(r.nUp,_.nUp),(!Number.isFinite(r.nUp)||r.nUp<1)&&(r.nUp=_.nUp),r.nUp=Math.floor(r.nUp),r.showLogicalPageNumber=u(r.showLogicalPageNumber,_.showLogicalPageNumber),r.showPhysicalPageNumber=u(r.showPhysicalPageNumber,_.showPhysicalPageNumber),r.papersizeWidth=S(r.papersizeWidth,_.papersizeWidth),r.papersizeHeight=S(r.papersizeHeight,_.papersizeHeight),r.paperSize=D(r.paperSize,_.paperSize),r.orientation=D(r.orientation,_.orientation),r.dpi=S(r.dpi,_.dpi),(!Number.isFinite(r.dpi)||r.dpi<=0)&&(r.dpi=_.dpi);const n=l=>Object.prototype.hasOwnProperty.call(o,l)&&o[l]!=="",i=Object.prototype.hasOwnProperty.call(e,"papersizeWidth")||Object.prototype.hasOwnProperty.call(t,"papersizeWidth")||n("papersizeWidth"),p=Object.prototype.hasOwnProperty.call(e,"papersizeHeight")||Object.prototype.hasOwnProperty.call(t,"papersizeHeight")||n("papersizeHeight");if(!i&&!p){const l=Z({paperSize:r.paperSize,orientation:r.orientation,dpi:r.dpi});l&&(r.papersizeWidth=l.width,r.papersizeHeight=l.height)}return r}const x=[{key:"repeatPaddt",datasetKey:"repeatPaddt",legacyKey:"repeat_paddt",defaultValue:!0,parser:u},{key:"insertPaddtDummyRowItems",datasetKey:"insertPaddtDummyRowItems",legacyKey:"insert_paddt_dummy_row_items",defaultValue:!0,parser:u},{key:"paddtMaxWordsPerSegment",datasetKey:"paddtMaxWordsPerSegment",legacyKey:"paddt_max_words_per_segment",defaultValue:200,parser:S},{key:"repeatPaddtRowheader",datasetKey:"repeatPaddtRowheader",legacyKey:"repeat_paddt_rowheader",defaultValue:!0,parser:u},{key:"paddtDebug",datasetKey:"paddtDebug",legacyKey:"paddt_debug",defaultValue:!1,parser:u},{key:"repeatPaddtDocinfo",datasetKey:"repeatPaddtDocinfo",legacyKey:"repeat_paddt_docinfo",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo002",datasetKey:"repeatPaddtDocinfo002",legacyKey:"repeat_paddt_docinfo002",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo003",datasetKey:"repeatPaddtDocinfo003",legacyKey:"repeat_paddt_docinfo003",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo004",datasetKey:"repeatPaddtDocinfo004",legacyKey:"repeat_paddt_docinfo004",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo005",datasetKey:"repeatPaddtDocinfo005",legacyKey:"repeat_paddt_docinfo005",defaultValue:!0,parser:u}],F=x.reduce(function(a,o){return a[o.key]=o.defaultValue,a},{});function oe(){return I(x)}function ne(a){return M(x,a)}function ie(a,o){o=o||{};var e=oe(),t=ne(a&&a.dataset||{}),r={};for(var n in F)Object.prototype.hasOwnProperty.call(F,n)&&(r[n]=F[n]);for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i]);for(var p in t)Object.prototype.hasOwnProperty.call(t,p)&&(r[p]=t[p]);for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(r[l]=o[l]);return r.paddtDebug=u(r.paddtDebug,F.paddtDebug),r.paddtMaxWordsPerSegment=S(r.paddtMaxWordsPerSegment,F.paddtMaxWordsPerSegment),(!Number.isFinite(r.paddtMaxWordsPerSegment)||r.paddtMaxWordsPerSegment<=0)&&(r.paddtMaxWordsPerSegment=F.paddtMaxWordsPerSegment),r}function se(a,o){const e=document.createElement("table");return e.className="dummy_row",e.setAttribute("width",`${a.papersizeWidth}px`),e.setAttribute("cellspacing","0"),e.setAttribute("cellpadding","0"),e.innerHTML=`<tr style="height:${m(o)}px;"><td style="border:0px solid black;"></td></tr>`,e}function pe(a){const o=document.createElement("table");return o.className="dummy_row_item",o.setAttribute("width",`${a.papersizeWidth}px`),o.setAttribute("cellspacing","0"),o.setAttribute("cellpadding","0"),a.customDummyRowItemContent?o.innerHTML=a.customDummyRowItemContent:o.innerHTML=`<tr style="height:${m(a.heightOfDummyRowItem)}px;"><td style="border:0px solid black;"></td></tr>`,o}function W(a,o,e){const t=m(a.heightOfDummyRowItem),r=m(e);if(t<=0||r<=0)return;const n=Math.floor(r/t);for(let i=0;i<n;i+=1)o.appendChild(pe(a))}function le(a,o,e){const t=m(e);t<=0||o.appendChild(se(a,t))}function ce(a,o,e,t,r){if(!a.insertDummyRowItemWhileFormatTable)return r&&console.log("[printform] applyDummyRowItemsStep: SKIPPED (insertDummyRowItemWhileFormatTable=false)"),m(t);const n=m(e-t);if(r&&(console.log("[printform] applyDummyRowItemsStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   remaining: ${n}px, itemHeight: ${a.heightOfDummyRowItem}px`)),n>0){W(a,o,n);const i=m(a.heightOfDummyRowItem);if(i>0){const p=Math.floor(n/i),l=m(n%i),s=m(e-l);return r&&(console.log(`[printform]   inserted ${p} dummy_row_items (${p} x ${i}px = ${p*i}px)`),console.log(`[printform]   remainder: ${l}px, newHeight: ${s}px`)),s}}return m(t)}function de(a,o,e,t,r){if(!a.insertDummyRowWhileFormatTable)return r&&console.log("[printform] applyDummyRowStep: SKIPPED (insertDummyRowWhileFormatTable=false)"),m(t);const n=m(e-t);return r&&(console.log("[printform] applyDummyRowStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   remaining: ${n}px`)),n>0?(le(a,o,n),r&&console.log(`[printform]   inserted 1 dummy_row with height: ${n}px`),m(t+n)):m(t)}function ue(a,o,e,t,r,n){if(!a.insertFooterSpacerWithDummyRowItemWhileFormatTable||r)return n&&console.log(`[printform] applyFooterSpacerWithDummyStep: SKIPPED (flag=${a.insertFooterSpacerWithDummyRowItemWhileFormatTable}, skipDummy=${r})`),{currentHeight:m(t),skipFooterSpacer:!1};const i=m(e-t);let p=m(t);if(n&&(console.log("[printform] applyFooterSpacerWithDummyStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   remaining: ${i}px`)),i>0){W(a,o,i);const l=m(a.heightOfDummyRowItem);if(l>0){const s=Math.floor(i/l),c=m(i%l);p=m(e-c),n&&console.log(`[printform]   inserted ${s} spacer dummy_row_items, remainder: ${c}px`)}}return{currentHeight:p,skipFooterSpacer:!0}}function fe(a,o,e,t,r,n,i){if(!a.insertFooterSpacerWhileFormatTable){i&&console.log("[printform] applyFooterSpacerStep: SKIPPED (insertFooterSpacerWhileFormatTable=false)");return}const p=n.cloneNode(!0);let l=m(e-t);const s=r&&r.nonRepeating?m(r.nonRepeating):0;s>0&&(l-=s);const c=Math.max(0,l);p.style.height=`${c}px`,o.appendChild(p),i&&(console.log("[printform] applyFooterSpacerStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   nonRepeatingFooter: ${s}px`),console.log(`[printform]   pfooter_spacer height: ${c}px`))}function ge(a,o){!a||!o||a.classList.contains(`${o}_processed`)||(a.classList.remove(o),a.classList.add(`${o}_processed`))}function me(a){if(!a)return 0;const o=a.offsetHeight||a.getBoundingClientRect().height,e=a.ownerDocument&&a.ownerDocument.defaultView||(typeof window<"u"?window:null);if(!e||!e.getComputedStyle)return m(o);const t=e.getComputedStyle(a),r=Number.parseFloat(t.marginTop)||0,n=Number.parseFloat(t.marginBottom)||0;return m(o+r+n)}function he(a){const o=document.createElement("div");o.classList.add("div_page_break_before"),o.setAttribute("style","page-break-before: always; font-size: 0pt; height: 0px;");const e=typeof window<"u"?window:globalThis,t=typeof a=="string"&&a.trim()?a:e&&typeof e.__printFormDividerClassAppend=="string"?e.__printFormDividerClassAppend:"";return t&&t.split(/\s+/).filter(Boolean).forEach(r=>o.classList.add(r)),o}function ye(a,o,e,t){if(!o)return null;const r=o.cloneNode(!0);return a.appendChild(r),e&&e(`append ${t}`),r}function Pe(a,o,e,t,r){if(!o)return;const n=o.cloneNode(!0);a.appendChild(n),e&&e(`append ${r||"prowitem"} ${t}`)}const f={markAsProcessed:ge,measureHeight:me,createPageBreakDivider:he,appendClone:ye,appendRowItem:Pe};function we(a){a.prototype.initializeOutputContainer=function(){const e=document.createElement("div");return e.classList.add("printform_formatter"),this.formEl.parentNode.insertBefore(e,this.formEl),e},a.prototype.initializePhysicalWrapper=function(e){this.currentPhysicalWrapper?(e.appendChild(f.createPageBreakDivider()),this.currentPhysicalPage+=1):this.currentPhysicalPage=1;const t=document.createElement("div");return t.classList.add("physical_page_wrapper"),t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start",t.style.width=`${this.config.papersizeWidth}px`,e.appendChild(t),this.currentPhysicalWrapper=t,this.pagesInCurrentPhysical=0,t},a.prototype.ensureCurrentPageContainer=function(e){return this.currentPhysicalWrapper||this.initializePhysicalWrapper(e),this.currentPageContainer||this.createNewLogicalPage(e),this.currentPageContainer},a.prototype.createNewLogicalPage=function(e){(!this.currentPhysicalWrapper||this.pagesInCurrentPhysical>=this.nUp)&&this.initializePhysicalWrapper(e);const t=document.createElement("div");return t.classList.add("printform_page"),t.style.width=`${this.config.papersizeWidth}px`,this.currentPhysicalWrapper.appendChild(t),this.currentPageContainer=t,this.pagesInCurrentPhysical+=1,this.logicalPageToPhysicalPage[this.currentPage]=this.currentPhysicalPage,t},a.prototype.getCurrentPageContainer=function(e){return this.ensureCurrentPageContainer(e)},a.prototype.finalizePageHeight=function(e){if(!e)return;const t=this.config.papersizeHeight,r=this.config.enforcePageHeight!==!1,n=f.measureHeight(e);if(this.debug){console.log(`
[printform] ========== PAGE HEIGHT CALCULATION ==========`),console.log(`[printform] Configured page height: ${t}px`),console.log(`[printform] Enforce page height: ${r?"ON":"OFF"}`),console.log("[printform] -------------------------------------------");const i=Array.from(e.children);let p=0;if(console.log(`[printform] Elements breakdown (${i.length} elements):`),i.forEach((l,s)=>{const c=f.measureHeight(l);p+=c;const d=l.className||"(no class)",g=l.tagName.toLowerCase();console.log(`[printform]   ${s+1}. <${g}.${d}>`),console.log(`[printform]      Height: ${c}px`),console.log(`[printform]      Cumulative: ${p}px`),console.log(`[printform]      Remaining: ${Math.max(0,t-p)}px`),c>t*.5&&console.log("[printform]      ⚠️  WARNING: Element height is > 50% of page height")}),console.log("[printform] -------------------------------------------"),console.log(`[printform] Total content height: ${p}px`),p<t){const l=t-p;console.log(`[printform] ✓ Content fits (${l}px under limit)`)}else if(p>t){const l=p-t;console.log(`[printform] ⚠️  Content overflow (${l}px over limit)`)}else console.log("[printform] ✓ Perfect fit (exactly matches configured height)")}if(r&&(e.style.boxSizing="border-box",e.style.height=`${t}px`),this.debug){if(console.log("[printform] -------------------------------------------"),console.log(`[printform] Actual measured content height: ${n}px`),r){const i=Math.max(0,n-t),p=Math.max(0,t-n);i>0?console.log(`[printform] ⚠️  Content overflow relative to configured height: ${i}px`):console.log(`[printform] ✓ Content fits (${p}px under configured height)`),console.log(`[printform] ✓ Page height set to: ${e.style.height}`)}else console.log("[printform] ℹ️  Page height NOT enforced - using natural content height");console.log(`[printform] ===============================================
`)}}}const _e=".prowitem, .ptac-rowitem, .paddt-rowitem",be=200,Se=200;function z(a,o){var e=a.cloneNode(!1);return e.textContent=o.join(" "),e.outerHTML||""}function v(a,o){if(!a)return[];var e=(a.textContent||"").trim();if(!e)return[a.outerHTML||""];var t=e.split(/\s+/).filter(function(p){return p&&p.length>0});if(t.length<=o)return[a.outerHTML||""];for(var r=[],n=[],i=0;i<t.length;i+=1)n.push(t[i]),n.length>=o&&(r.push(z(a,n)),n=[]);return n.length>0&&r.push(z(a,n)),r}function Ne(a,o){return v(a,o)}function Re(a){a.prototype.collectSections=function(){this.expandPaddtSegments(),this.expandPtacSegments();const e=Y.map(p=>{const l=this.formEl.querySelector(`.${p.className}`);return l?{key:p.key,className:p.className,repeatFlag:p.repeatFlag,element:l}:null}).filter(Boolean),t=ee.map(p=>{const l=this.formEl.querySelector(`.${p.className}`);return l?{key:p.key,className:p.className,repeatFlag:p.repeatFlag,element:l}:null}).filter(Boolean),r=Array.from(this.formEl.querySelectorAll(_e)),n=r.filter(p=>this.isPaddtRow(p)),i=r.filter(p=>!this.isPaddtRow(p));return this.paddtRows=n,{header:this.formEl.querySelector(".pheader"),docInfos:e,rowHeader:this.formEl.querySelector(".prowheader"),footerVariants:t,footerLogo:this.formEl.querySelector(`.${H.className}`),footerPagenum:this.formEl.querySelector(`.${k.className}`),rows:i}},a.prototype.measureSections=function(e){const t={header:f.measureHeight(e.header),docInfos:{},rowHeader:f.measureHeight(e.rowHeader),footerVariants:{},footerLogo:f.measureHeight(e.footerLogo),footerPagenum:f.measureHeight(e.footerPagenum)};return e.docInfos.forEach(r=>{t.docInfos[r.key]=f.measureHeight(r.element)}),e.footerVariants.forEach(r=>{t.footerVariants[r.key]=f.measureHeight(r.element)}),t},a.prototype.markSectionsProcessed=function(e){f.markAsProcessed(e.header,"pheader"),e.docInfos.forEach(t=>{f.markAsProcessed(t.element,t.className)}),f.markAsProcessed(e.rowHeader,"prowheader"),e.footerVariants.forEach(t=>{f.markAsProcessed(t.element,t.className)}),f.markAsProcessed(e.footerLogo,H.className),f.markAsProcessed(e.footerPagenum,k.className)},a.prototype.createFooterSpacerTemplate=function(){const e=document.createElement("div");return e.classList.add("pfooter_spacer","paper_width"),e.style.height="0px",e}}function Fe(a){a.prototype.isPaddtRow=function(e){return e?e.classList.contains("paddt_segment")||e.classList.contains("paddt")||e.classList.contains("paddt-rowitem")||e.classList.contains("paddt-rowitem_processed"):!1},a.prototype.isPtacRow=function(e){return e?e.classList.contains("ptac_segment")||e.classList.contains("ptac")||e.classList.contains("ptac-rowitem")||e.classList.contains("ptac-rowitem_processed"):!1},a.prototype.getRowBaseClass=function(e){return e?this.isPaddtRow(e)?"paddt-rowitem":this.isPtacRow(e)?"ptac-rowitem":"prowitem":"prowitem"},a.prototype.shouldSkipRowHeaderForRow=function(e){return!e||!this.config.repeatRowheader?!1:e.classList.contains("without_prowheader")||e.classList.contains("tb_without_rowheader")?!0:this.isPtacRow(e)?!this.config.repeatPtacRowheader:this.isPaddtRow(e)?!(this.paddtConfig&&this.paddtConfig.repeatPaddtRowheader):!1},a.prototype.shouldSkipDummyRowItemsForContext=function(e){return!!(e&&(e.isPtacPage&&!this.config.insertPtacDummyRowItems||e.isPaddtPage&&!(this.paddtConfig&&this.paddtConfig.insertPaddtDummyRowItems)))}}function De(a){a.prototype.expandPaddtSegments=function(){if(this.formEl.dataset.paddtExpanded==="true")return;const e=Array.from(this.formEl.querySelectorAll(".paddt"));if(e.length===0){this.formEl.dataset.paddtExpanded="true";return}var t=this.paddtConfig&&this.paddtConfig.paddtMaxWordsPerSegment||Se;e.forEach(r=>{if(!r||r.dataset.paddtSegment==="true")return;const n=r.querySelector("td > div")||r.querySelector("td");if(!n){r.classList.add("paddt-rowitem","paddt_segment"),r.dataset.paddtSegment="true";return}const i=Array.from(n.querySelectorAll("p"));var p=null;i.length>1&&(p=i.shift());const l=i;if(l.length===0){r.classList.add("paddt-rowitem","paddt_segment"),r.dataset.paddtSegment="true";return}const s=p?p.outerHTML:"",c=l.reduce(function(P,w){const C=Ne(w,t);return P.concat(C)},[]);if(c.length===0){n.innerHTML=s,r.classList.add("paddt-rowitem","paddt_segment"),r.dataset.paddtSegment="true";return}const d=[];if(s){d.push(s+c[0]);for(var g=1;g<c.length;g+=1)d.push(c[g])}else for(var h=0;h<c.length;h+=1)d.push(c[h]);if(d.length===0){n.innerHTML=s,r.classList.add("paddt-rowitem","paddt_segment"),r.dataset.paddtSegment="true";return}n.innerHTML=d[0],r.classList.add("paddt-rowitem","paddt_segment"),r.dataset.paddtSegment="true";for(var y=r,b=1;b<d.length;b+=1){const P=r.cloneNode(!0);P.dataset.paddtSegment="true";const w=P.querySelector("td > div")||P.querySelector("td");w&&(w.innerHTML=d[b]),y.parentNode.insertBefore(P,y.nextSibling),y=P}}),this.formEl.dataset.paddtExpanded="true"}}function Ce(a){a.prototype.expandPtacSegments=function(){if(this.formEl.dataset.ptacExpanded==="true")return;const e=Array.from(this.formEl.querySelectorAll(".ptac"));if(e.length===0){this.formEl.dataset.ptacExpanded="true";return}e.forEach(t=>{if(!t||t.dataset.ptacSegment==="true")return;const r=t.querySelector("td > div")||t.querySelector("td");if(!r){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}const n=Array.from(r.children);if(n.length===0){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}const i=[];if(n.forEach(s=>{s.tagName.toLowerCase()==="p"?v(s,be).forEach(d=>i.push(d)):i.push(s.outerHTML)}),i.length===0){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}r.innerHTML=i[0],t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";for(var p=t,l=1;l<i.length;l+=1){const s=t.cloneNode(!0);s.classList.remove("tb_page_break_before"),s.dataset.ptacSegment="true";const c=s.querySelector("td > div")||s.querySelector("td");c&&(c.innerHTML=i[l]),p.parentNode.insertBefore(s,p.nextSibling),p=s}}),this.formEl.dataset.ptacExpanded="true"}}function He(a){a.prototype.ensureFirstPageSections=function(e,t,r,n,i){let p=0;return t.header&&(f.appendClone(e,t.header,n,"pheader"),this.config.repeatHeader||(p+=r.header)),t.docInfos.forEach(l=>{const s=f.appendClone(e,l.element,n,l.className);this.registerPageNumberClone(s),this.config[l.repeatFlag]||(p+=r.docInfos[l.key]||0)}),t.rowHeader&&!i&&(f.appendClone(e,t.rowHeader,n,"prowheader"),this.config.repeatRowheader||(p+=r.rowHeader)),p},a.prototype.appendRepeatingSections=function(e,t,r,n){this.config.repeatHeader&&f.appendClone(e,t.header,r,"pheader"),t.docInfos.forEach(i=>{if(this.config[i.repeatFlag]){const p=f.appendClone(e,i.element,r,i.className);this.registerPageNumberClone(p)}}),this.config.repeatRowheader&&!n&&f.appendClone(e,t.rowHeader,r,"prowheader")},a.prototype.registerPageNumberClone=function(e){if(!e)return!1;let t=!1;if(this.showLogicalPageNumber&&e.querySelector("[data-page-number], [data-page-total], [data-page-number-container]")&&(K(e,this.currentPage,null),this.logicalPageNumberClones.push({node:e,pageNumber:this.currentPage}),t=!0),this.showPhysicalPageNumber&&e.querySelector("[data-physical-page-number], [data-physical-page-total], [data-physical-page-number-container]")){const r=this.logicalPageToPhysicalPage[this.currentPage]||this.currentPhysicalPage||1;A(e,r,null),this.physicalPageNumberClones.push({node:e,pageNumber:r}),t=!0}return t},a.prototype.appendRepeatingFooters=function(e,t,r){t.footerVariants.forEach(n=>{this.config[n.repeatFlag]&&f.appendClone(e,n.element,r,n.className)}),this.config.repeatFooterLogo&&f.appendClone(e,t.footerLogo,r,H.className),this.config.repeatFooterPagenum&&this.appendFooterPageNumber(e,t,r)},a.prototype.appendFinalFooters=function(e,t,r){t.footerVariants.forEach(n=>{f.appendClone(e,n.element,r,n.className)}),f.appendClone(e,t.footerLogo,r,H.className),this.appendFooterPageNumber(e,t,r)},a.prototype.appendFooterPageNumber=function(e,t,r){if(!t.footerPagenum)return;const n=t.footerPagenum.cloneNode(!0);e.appendChild(n),this.registerPageNumberClone(n),r&&r(`append ${k.className} page ${this.currentPage}`)},a.prototype.updatePageNumberTotals=function(){if(!this.logicalPageNumberClones.length&&!this.physicalPageNumberClones.length)return;const e=this.currentPage,t=this.currentPhysicalPage||1;this.logicalPageNumberClones.forEach(r=>{K(r.node,r.pageNumber,e)}),this.physicalPageNumberClones.forEach(r=>{A(r.node,r.pageNumber,t)})}}function Le(a){a.prototype.initializePageContext=function(e){return{baseLimit:e,limit:e,skipRowHeader:!1,isPtacPage:!1,isPaddtPage:!1}},a.prototype.refreshPageContextForRow=function(e,t,r){if(!e)return e;const n=this.shouldSkipRowHeaderForRow(t),i=r.rowHeader||0;return e.skipRowHeader=n,e.isPtacPage=this.isPtacRow(t),e.isPaddtPage=this.isPaddtRow(t),e.limit=e.baseLimit+(n?i:0),e},a.prototype.renderRows=function(e,t,r,n,i,p,l){let s=0;const c=this.initializePageContext(i);return this.debug&&(console.log("[printform] ===== renderRows START ====="),console.log(`[printform] Total rows: ${t.rows.length}, heightPerPage: ${i}px`)),t.rows.forEach((d,g)=>{const h=f.measureHeight(d),y=this.getRowBaseClass(d),b=this.isPtacRow(d),P=this.isPaddtRow(d);if(!h){f.markAsProcessed(d,y);return}if(s===0){this.refreshPageContextForRow(c,d,r);const w=this.getCurrentPageContainer(e);s+=this.ensureFirstPageSections(w,t,r,l,c.skipRowHeader),this.debug&&console.log(`[printform] Page ${this.currentPage} start: firstSectionHeight=${s}px, pageLimit=${c.limit}px`)}if(s+=h,this.debug&&console.log(`[printform]   row[${g}] height=${h}px, currentHeight=${s}px, limit=${c.limit}px`),f.markAsProcessed(d,y),d.classList.contains("tb_page_break_before")){this.debug&&console.log(`[printform]   >> PAGE BREAK (tb_page_break_before) at row[${g}]`),s-=h;const w=this.shouldSkipDummyRowItemsForContext(c),C=this.shouldSkipRowHeaderForRow(d);s=this.prepareNextPage(e,t,l,c.limit,s,n,p,C,w),this.refreshPageContextForRow(c,d,r);const $=this.getCurrentPageContainer(e);f.appendRowItem($,d,l,g,y),s=h,this.debug&&console.log(`[printform] Page ${this.currentPage} start: currentHeight=${s}px, limit=${c.limit}px`),b||(c.isPtacPage=!1),P||(c.isPaddtPage=!1)}else if(s<=c.limit){const w=this.getCurrentPageContainer(e);f.appendRowItem(w,d,l,g,y),b||(c.isPtacPage=!1),P||(c.isPaddtPage=!1)}else{s-=h,this.debug&&console.log(`[printform]   >> PAGE BREAK (overflow) at row[${g}]`);const w=this.shouldSkipDummyRowItemsForContext(c),C=this.shouldSkipRowHeaderForRow(d);s=this.prepareNextPage(e,t,l,c.limit,s,n,p,C,w),this.refreshPageContextForRow(c,d,r);const $=this.getCurrentPageContainer(e);f.appendRowItem($,d,l,g,y),s=h,this.debug&&console.log(`[printform] Page ${this.currentPage} start: currentHeight=${s}px, limit=${c.limit}px`),b||(c.isPtacPage=!1),P||(c.isPaddtPage=!1)}}),this.debug&&console.log(`[printform] ===== renderRows END (page ${this.currentPage}, finalHeight=${s}px) =====`),{currentHeight:s,pageLimit:c.limit,isPtacPage:c.isPtacPage,isPaddtPage:c.isPaddtPage}},a.prototype.prepareNextPage=function(e,t,r,n,i,p,l,s,c){const d=this.getCurrentPageContainer(e),g=this.applyRemainderSpacing(d,n,i,p,l,{skipDummyRowItems:c});this.appendRepeatingFooters(d,t,r),this.currentPage+=1,this.currentPageContainer=null,this.createNewLogicalPage(e);const h=this.getCurrentPageContainer(e);return this.appendRepeatingSections(h,t,r,s),g},a.prototype.applyRemainderSpacing=function(e,t,r,n,i,p){const l=p&&p.skipDummyRowItems;let s=m(r);this.debug&&(console.log(`[printform] ----- applyRemainderSpacing (page ${this.currentPage}) -----`),console.log(`[printform]   heightPerPage: ${t}px, currentHeight: ${r}px`),console.log(`[printform]   skipDummyRowItems: ${l}`)),l||(s=ce(this.config,e,t,s,this.debug)),s=de(this.config,e,t,s,this.debug);const c=ue(this.config,e,t,s,l,this.debug);return s=c.currentHeight,c.skipFooterSpacer||fe(this.config,e,t,s,n,i,this.debug),this.debug&&(console.log(`[printform]   finalHeight after spacing: ${s}px`),console.log("[printform] -----------------------------------------")),m(s)}}function ke(a){a.prototype.computeHeightPerPage=function(e,t){let r=this.config.papersizeHeight;if(this.debug&&(console.log("[printform] ===== computeHeightPerPage ====="),console.log(`[printform] papersizeHeight (config): ${this.config.papersizeHeight}px`),console.log(`[printform] papersizeWidth (config): ${this.config.papersizeWidth}px`)),this.config.repeatHeader&&e.header&&(this.debug&&console.log(`[printform]   - repeatHeader: ${t.header}px`),r-=t.header),e.docInfos.forEach(n=>{if(this.config[n.repeatFlag]){const i=t.docInfos[n.key]||0;this.debug&&console.log(`[printform]   - repeat ${n.className}: ${i}px`),r-=i}}),this.config.repeatRowheader&&e.rowHeader&&(this.debug&&console.log(`[printform]   - repeatRowheader: ${t.rowHeader}px`),r-=t.rowHeader),e.footerVariants.forEach(n=>{if(this.config[n.repeatFlag]){const i=t.footerVariants[n.key]||0;this.debug&&console.log(`[printform]   - repeat ${n.className}: ${i}px`),r-=i}}),this.config.repeatFooterLogo&&e.footerLogo&&(this.debug&&console.log(`[printform]   - repeatFooterLogo: ${t.footerLogo}px`),r-=t.footerLogo),this.config.repeatFooterPagenum&&e.footerPagenum){const n=t.footerPagenum||0;this.debug&&console.log(`[printform]   - repeatFooterPagenum: ${n}px`),r-=n}return this.debug&&(console.log(`[printform] heightPerPage (available for content): ${Math.max(0,r)}px`),console.log("[printform] ================================")),Math.max(0,r)},a.prototype.computeFooterState=function(e,t){const r=t.footerLogo||0,n=t.footerPagenum||0,p=e.footerVariants.reduce((d,g)=>{const h=t.footerVariants[g.key]||0;return d+h},0)+r+n;let s=e.footerVariants.reduce((d,g)=>{const h=t.footerVariants[g.key]||0;return this.config[g.repeatFlag]?d+h:d},0);this.config.repeatFooterLogo&&(s+=r),this.config.repeatFooterPagenum&&(s+=n);const c=Math.max(0,p-s);return{totalFinal:p,repeating:s,nonRepeating:c}},a.prototype.finalizeDocument=function(e,t,r,n,i,p,l){const s=i?i.currentHeight:0,c=i&&i.pageLimit?i.pageLimit:n,d=!!(i&&(i.isPtacPage&&!this.config.insertPtacDummyRowItems||i.isPaddtPage&&!(this.paddtConfig&&this.paddtConfig.insertPaddtDummyRowItems))),g=r.totalFinal-r.repeating,h=s+g;if(h<=c){const P=this.getCurrentPageContainer(e);this.applyRemainderSpacing(P,c,h,r,p,{skipDummyRowItems:d}),this.appendFinalFooters(P,t,l);return}this.prepareNextPage(e,t,l,c,s,r,p,!1,d);const y=g,b=this.getCurrentPageContainer(e);this.applyRemainderSpacing(b,n,y,r,p,null),this.appendFinalFooters(b,t,l)}}class N{constructor(o,e){this.formEl=o,this.config=e,this.debug=!!e.debug,this.nUp=Math.max(1,Math.floor(Number(e.nUp||1))),this.showLogicalPageNumber=e.showLogicalPageNumber!==!1,this.showPhysicalPageNumber=!!e.showPhysicalPageNumber,this.paddtConfig=ie(o,{}),this.paddtDebug=!!this.paddtConfig.paddtDebug,this.currentPage=1,this.currentPhysicalPage=0,this.pagesInCurrentPhysical=0,this.currentPhysicalWrapper=null,this.currentPageContainer=null,this.logicalPageNumberClones=[],this.physicalPageNumberClones=[],this.logicalPageToPhysicalPage=[],this.debug&&(console.log("[printform] ===== PrintFormFormatter initialized ====="),console.log("[printform] debug mode: ON"),console.log(`[printform] config.debug raw value: ${e.debug}`))}log(o){this.debug&&console.log(`[printform] ${o}`)}format(){const o=this.debug?this.log.bind(this):null,e=this.initializeOutputContainer();this.ensureCurrentPageContainer(e);const t=this.collectSections(),r=this.measureSections(t),n=this.createFooterSpacerTemplate();this.markSectionsProcessed(t);const i=this.computeFooterState(t,r),p=this.computeHeightPerPage(t,r),l=this.renderRows(e,t,r,i,p,n,o);if(this.finalizeDocument(e,t,i,p,l,n,o),this.paddtRows&&this.paddtRows.length){this.currentPage+=1,this.currentPageContainer=null,this.initializePhysicalWrapper(e),this.createNewLogicalPage(e);var s={docInfo:this.paddtConfig.repeatPaddtDocinfo,docInfo002:this.paddtConfig.repeatPaddtDocinfo002,docInfo003:this.paddtConfig.repeatPaddtDocinfo003,docInfo004:this.paddtConfig.repeatPaddtDocinfo004,docInfo005:this.paddtConfig.repeatPaddtDocinfo005},c=t.docInfos.filter(function(P){var w=s[P.key];return w===void 0?!0:!!w});const g={header:t.header,docInfos:c,rowHeader:t.rowHeader,footerVariants:[],footerLogo:t.footerLogo,footerPagenum:t.footerPagenum,rows:this.paddtRows},h=this.computeFooterState(g,r),y=this.computeHeightPerPage(g,r),b=this.renderRows(e,g,r,h,y,n,o);this.finalizeDocument(e,g,h,y,b,n,o)}this.updatePageNumberTotals();const d=e.querySelectorAll(".printform_page");return this.debug&&console.log(`[printform] Finalizing heights for ${d.length} pages...`),d.forEach((g,h)=>{if(this.finalizePageHeight(g),this.debug){const y=g.style.height||g.style.minHeight||"(auto)";console.log(`[printform]   Page ${h+1}: height set to ${y}`)}}),e.classList.remove("printform_formatter"),e.classList.add("printform_formatter_processed"),this.formEl.remove(),e}}we(N),Re(N),Fe(N),De(N),Ce(N),He(N),Le(N),ke(N);function O(a,o,e){const t=a.__printFormDividerClassAppend;a.__printFormDividerClassAppend=typeof o=="string"?o:"";try{return e()}finally{t===void 0?delete a.__printFormDividerClassAppend:a.__printFormDividerClassAppend=t}}function xe(a){return new Promise((o,e)=>{setTimeout(o,a)})}async function B(a={}){const o=typeof window<"u"?window:globalThis;if(!o.__printFormProcessing&&!(!a.force&&o.__printFormProcessed)){o.__printFormProcessing=!0;try{const e=o.document;if(!e)return;const t=Array.from(e.querySelectorAll(".printform"));for(let r=0;r<t.length;r+=1){const n=t[r],i={...a};if(i.divPageBreakBeforeClassAppend===void 0&&n&&n.dataset){const s=n.dataset.divPageBreakBeforeClassAppend;typeof s=="string"&&s.trim()&&(i.divPageBreakBeforeClassAppend=s.trim())}const p=i.divPageBreakBeforeClassAppend,l=V(n,i);try{await xe(1)}catch(s){console.error("pauseInMilliseconds error",s)}try{const s=O(o,p,()=>new N(n,l).format());r>0&&s&&s.parentNode&&s.parentNode.insertBefore(f.createPageBreakDivider(p),s)}catch(s){console.error("printform format error",s)}}o.__printFormProcessed=!0}finally{o.__printFormProcessing=!1}}}function Ee(a,o={}){const e=typeof window<"u"?window:globalThis,t={...o};if(t.divPageBreakBeforeClassAppend===void 0&&a&&a.dataset){const i=a.dataset.divPageBreakBeforeClassAppend;typeof i=="string"&&i.trim()&&(t.divPageBreakBeforeClassAppend=i.trim())}const r=t.divPageBreakBeforeClassAppend,n=V(a,t);return O(e,r,()=>new N(a,n).format())}const E={formatAll:B,format:Ee,DEFAULT_CONFIG:_,DEFAULT_PADDT_CONFIG:F},R=typeof window<"u"?window:null;if(R)if(R.__printFormScriptLoaded__)R.PrintForm=R.PrintForm||E;else{R.__printFormScriptLoaded__=!0,R.PrintForm=R.PrintForm||{},Object.assign(R.PrintForm,E);const a=R.document;a&&a.addEventListener&&a.addEventListener("DOMContentLoaded",()=>{B()})}return E}();
