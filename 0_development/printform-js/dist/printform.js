var PrintForm=function(){"use strict";const U=new Set(["y","yes","true","1"]),G=new Set(["n","no","false","0"]);function u(r,o){if(r==null||r==="")return o;if(typeof r=="boolean")return r;if(typeof r=="number")return r!==0;const e=String(r).trim().toLowerCase();return U.has(e)?!0:G.has(e)?!1:o}function w(r,o){if(r==null||r==="")return o;const e=Number(r);return Number.isFinite(e)?e:o}function F(r,o){return r==null||r===""?o:String(r)}function j(r){const o=String(r||"").trim().toLowerCase();return o==="landscape"?"landscape":o==="portrait"?"portrait":""}function X(r){const o=String(r||"").trim();if(!o)return"";const e=o.toUpperCase();return e==="A4"||e==="A5"||e==="LETTER"||e==="LEGAL"?e:e==="US_LETTER"||e==="USLETTER"?"LETTER":e==="US_LEGAL"||e==="USLEGAL"?"LEGAL":""}function $(r,o){const e=Number(r),t=Number(o);return!Number.isFinite(e)||!Number.isFinite(t)||t<=0?0:Math.round(e/25.4*t)}const Z={A4:{widthMm:210,heightMm:297},A5:{widthMm:148,heightMm:210},LETTER:{widthMm:215.9,heightMm:279.4},LEGAL:{widthMm:215.9,heightMm:355.6}};function J(r){const o=X(r&&r.paperSize);if(!o)return null;const e=Z[o];if(!e)return null;const t=Number(r&&r.dpi),a=$(e.widthMm,t),i=$(e.heightMm,t);return!a||!i?null:(j(r&&r.orientation)||"portrait")==="landscape"?{width:i,height:a}:{width:a,height:i}}function m(r){const o=Number(r);return Number.isFinite(o)?Math.max(0,Math.round(o)):0}function Q(r){if(!r)return null;if(r.__pageNumberPlaceholder)return r.__pageNumberPlaceholder;const o=r.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;let e=r.querySelector("[data-page-number-container]");e||(e=r.querySelector("td:last-child")||r.querySelector("td")||r);const t=o.createElement("span");return t.className="printform_page_number_placeholder",e.appendChild(t),r.__pageNumberPlaceholder=t,t}function Y(r){if(!r)return null;if(r.__physicalPageNumberPlaceholder)return r.__physicalPageNumberPlaceholder;const o=r.ownerDocument||(typeof document<"u"?document:null);if(!o)return null;let e=r.querySelector("[data-physical-page-number-container]");e||(e=r.querySelector("td:last-child")||r.querySelector("td")||r);const t=o.createElement("span");return t.className="printform_physical_page_number_placeholder",e.appendChild(t),r.__physicalPageNumberPlaceholder=t,t}function K(r,o,e){if(!r)return;const t=r.querySelectorAll("[data-page-number]");t.length>0&&t.forEach(function(n){n.textContent=o});const a=r.querySelectorAll("[data-page-total]"),i=e??"";if(a.length>0&&a.forEach(function(n){n.textContent=i}),t.length===0&&a.length===0){const n=Q(r);n&&(n.textContent=e!=null?"Page "+o+" of "+e:"Page "+o)}}function A(r,o,e){if(!r)return;const t=r.querySelectorAll("[data-physical-page-number]");t.length>0&&t.forEach(function(n){n.textContent=o});const a=r.querySelectorAll("[data-physical-page-total]"),i=e??"";if(a.length>0&&a.forEach(function(n){n.textContent=i}),t.length===0&&a.length===0){const n=Y(r);n&&(n.textContent=e!=null?"Sheet "+o+" of "+e:"Sheet "+o)}}const H=[{key:"papersizeWidth",datasetKey:"papersizeWidth",legacyKey:"papersize_width",defaultValue:750,parser:w},{key:"papersizeHeight",datasetKey:"papersizeHeight",legacyKey:"papersize_height",defaultValue:1050,parser:w},{key:"paperSize",datasetKey:"paperSize",legacyKey:"paper_size",defaultValue:"",parser:F},{key:"orientation",datasetKey:"orientation",legacyKey:"orientation",defaultValue:"portrait",parser:F},{key:"dpi",datasetKey:"dpi",legacyKey:"dpi",defaultValue:96,parser:w},{key:"nUp",datasetKey:"nUp",legacyKey:"n_up",defaultValue:1,parser:w},{key:"showLogicalPageNumber",datasetKey:"showLogicalPageNumber",legacyKey:"show_logical_page_number",defaultValue:!0,parser:u},{key:"showPhysicalPageNumber",datasetKey:"showPhysicalPageNumber",legacyKey:"show_physical_page_number",defaultValue:!1,parser:u},{key:"heightOfDummyRowItem",datasetKey:"heightOfDummyRowItem",legacyKey:"height_of_dummy_row_item",defaultValue:18,parser:w},{key:"repeatHeader",datasetKey:"repeatHeader",legacyKey:"repeat_header",defaultValue:!0,parser:u},{key:"repeatDocinfo",datasetKey:"repeatDocinfo",legacyKey:"repeat_docinfo",defaultValue:!0,parser:u},{key:"repeatDocinfo002",datasetKey:"repeatDocinfo002",legacyKey:"repeat_docinfo002",defaultValue:!0,parser:u},{key:"repeatDocinfo003",datasetKey:"repeatDocinfo003",legacyKey:"repeat_docinfo003",defaultValue:!0,parser:u},{key:"repeatDocinfo004",datasetKey:"repeatDocinfo004",legacyKey:"repeat_docinfo004",defaultValue:!0,parser:u},{key:"repeatDocinfo005",datasetKey:"repeatDocinfo005",legacyKey:"repeat_docinfo005",defaultValue:!0,parser:u},{key:"repeatRowheader",datasetKey:"repeatRowheader",legacyKey:"repeat_rowheader",defaultValue:!0,parser:u},{key:"repeatPtacRowheader",datasetKey:"repeatPtacRowheader",legacyKey:"repeat_ptac_rowheader",defaultValue:!0,parser:u},{key:"repeatFooter",datasetKey:"repeatFooter",legacyKey:"repeat_footer",defaultValue:!1,parser:u},{key:"repeatFooter002",datasetKey:"repeatFooter002",legacyKey:"repeat_footer002",defaultValue:!1,parser:u},{key:"repeatFooter003",datasetKey:"repeatFooter003",legacyKey:"repeat_footer003",defaultValue:!1,parser:u},{key:"repeatFooter004",datasetKey:"repeatFooter004",legacyKey:"repeat_footer004",defaultValue:!1,parser:u},{key:"repeatFooter005",datasetKey:"repeatFooter005",legacyKey:"repeat_footer005",defaultValue:!1,parser:u},{key:"repeatFooterLogo",datasetKey:"repeatFooterLogo",legacyKey:"repeat_footer_logo",defaultValue:!1,parser:u},{key:"repeatFooterPagenum",datasetKey:"repeatFooterPagenum",legacyKey:"repeat_footer_pagenum",defaultValue:!1,parser:u},{key:"fillPageHeightAfterFooter",datasetKey:"fillPageHeightAfterFooter",legacyKey:"fill_page_height_after_footer",defaultValue:!0,parser:u},{key:"insertDummyRowItemWhileFormatTable",datasetKey:"insertDummyRowItemWhileFormatTable",legacyKey:"insert_dummy_row_item_while_format_table",defaultValue:!0,parser:u},{key:"insertPtacDummyRowItems",datasetKey:"insertPtacDummyRowItems",legacyKey:"insert_ptac_dummy_row_items",defaultValue:!0,parser:u},{key:"insertDummyRowWhileFormatTable",datasetKey:"insertDummyRowWhileFormatTable",legacyKey:"insert_dummy_row_while_format_table",defaultValue:!1,parser:u},{key:"insertFooterSpacerWhileFormatTable",datasetKey:"insertFooterSpacerWhileFormatTable",legacyKey:"insert_footer_spacer_while_format_table",defaultValue:!0,parser:u},{key:"insertFooterSpacerWithDummyRowItemWhileFormatTable",datasetKey:"insertFooterSpacerWithDummyRowItemWhileFormatTable",legacyKey:"insert_footer_spacer_with_dummy_row_item_while_format_table",defaultValue:!0,parser:u},{key:"customDummyRowItemContent",datasetKey:"customDummyRowItemContent",legacyKey:"custom_dummy_row_item_content",defaultValue:"",parser:F},{key:"debug",datasetKey:"debug",legacyKey:"debug_printform",defaultValue:!1,parser:u}],ee=[{key:"docInfo",className:"pdocinfo",repeatFlag:"repeatDocinfo"},{key:"docInfo002",className:"pdocinfo002",repeatFlag:"repeatDocinfo002"},{key:"docInfo003",className:"pdocinfo003",repeatFlag:"repeatDocinfo003"},{key:"docInfo004",className:"pdocinfo004",repeatFlag:"repeatDocinfo004"},{key:"docInfo005",className:"pdocinfo005",repeatFlag:"repeatDocinfo005"}],I=[{key:"footer",className:"pfooter",repeatFlag:"repeatFooter"},{key:"footer002",className:"pfooter002",repeatFlag:"repeatFooter002"},{key:"footer003",className:"pfooter003",repeatFlag:"repeatFooter003"},{key:"footer004",className:"pfooter004",repeatFlag:"repeatFooter004"},{key:"footer005",className:"pfooter005",repeatFlag:"repeatFooter005"}],k={className:"pfooter_logo"},C={className:"pfooter_pagenum"},y=H.reduce((r,o)=>(r[o.key]=o.defaultValue,r),{});function V(r){const o=typeof window<"u"?window:typeof globalThis<"u"?globalThis:{};return r.reduce((e,t)=>{if(!t.legacyKey)return e;const a=o[t.legacyKey];return a==null||a===""||(e[t.key]=t.parser(a,t.defaultValue)),e},{})}function W(r,o){const e=o||{};return r.reduce((t,a)=>{if(!a.datasetKey||!Object.prototype.hasOwnProperty.call(e,a.datasetKey))return t;const i=e[a.datasetKey];return i==null||i===""||(t[a.key]=a.parser(i,a.defaultValue)),t},{})}function te(){return V(H)}function re(r){return W(H,r)}function ae(r,o){const e=r.querySelector("template.custom-dummy-row-item-content");return e?e.innerHTML.trim():o}function M(r,o={}){const e=te(),t=re(r.dataset||{}),a={...y,...e,...t,...o};a.customDummyRowItemContent=ae(r,o.customDummyRowItemContent!==void 0?o.customDummyRowItemContent:a.customDummyRowItemContent),a.debug=u(a.debug,y.debug),a.nUp=w(a.nUp,y.nUp),(!Number.isFinite(a.nUp)||a.nUp<1)&&(a.nUp=y.nUp),a.nUp=Math.floor(a.nUp),a.showLogicalPageNumber=u(a.showLogicalPageNumber,y.showLogicalPageNumber),a.showPhysicalPageNumber=u(a.showPhysicalPageNumber,y.showPhysicalPageNumber),a.papersizeWidth=w(a.papersizeWidth,y.papersizeWidth),a.papersizeHeight=w(a.papersizeHeight,y.papersizeHeight),a.paperSize=F(a.paperSize,y.paperSize),a.orientation=F(a.orientation,y.orientation),a.dpi=w(a.dpi,y.dpi),(!Number.isFinite(a.dpi)||a.dpi<=0)&&(a.dpi=y.dpi);const i=l=>Object.prototype.hasOwnProperty.call(o,l)&&o[l]!=="",n=Object.prototype.hasOwnProperty.call(e,"papersizeWidth")||Object.prototype.hasOwnProperty.call(t,"papersizeWidth")||i("papersizeWidth"),s=Object.prototype.hasOwnProperty.call(e,"papersizeHeight")||Object.prototype.hasOwnProperty.call(t,"papersizeHeight")||i("papersizeHeight");if(!n&&!s){const l=J({paperSize:a.paperSize,orientation:a.orientation,dpi:a.dpi});l&&(a.papersizeWidth=l.width,a.papersizeHeight=l.height)}return a}const L=[{key:"repeatPaddt",datasetKey:"repeatPaddt",legacyKey:"repeat_paddt",defaultValue:!0,parser:u},{key:"insertPaddtDummyRowItems",datasetKey:"insertPaddtDummyRowItems",legacyKey:"insert_paddt_dummy_row_items",defaultValue:!0,parser:u},{key:"paddtMaxWordsPerSegment",datasetKey:"paddtMaxWordsPerSegment",legacyKey:"paddt_max_words_per_segment",defaultValue:200,parser:w},{key:"repeatPaddtRowheader",datasetKey:"repeatPaddtRowheader",legacyKey:"repeat_paddt_rowheader",defaultValue:!0,parser:u},{key:"paddtDebug",datasetKey:"paddtDebug",legacyKey:"paddt_debug",defaultValue:!1,parser:u},{key:"repeatPaddtDocinfo",datasetKey:"repeatPaddtDocinfo",legacyKey:"repeat_paddt_docinfo",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo002",datasetKey:"repeatPaddtDocinfo002",legacyKey:"repeat_paddt_docinfo002",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo003",datasetKey:"repeatPaddtDocinfo003",legacyKey:"repeat_paddt_docinfo003",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo004",datasetKey:"repeatPaddtDocinfo004",legacyKey:"repeat_paddt_docinfo004",defaultValue:!0,parser:u},{key:"repeatPaddtDocinfo005",datasetKey:"repeatPaddtDocinfo005",legacyKey:"repeat_paddt_docinfo005",defaultValue:!0,parser:u}],D=L.reduce(function(r,o){return r[o.key]=o.defaultValue,r},{});function oe(){return V(L)}function ie(r){return W(L,r)}function ne(r,o){o=o||{};var e=oe(),t=ie(r&&r.dataset||{}),a={};for(var i in D)Object.prototype.hasOwnProperty.call(D,i)&&(a[i]=D[i]);for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(a[s]=t[s]);for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(a[l]=o[l]);return a.paddtDebug=u(a.paddtDebug,D.paddtDebug),a.paddtMaxWordsPerSegment=w(a.paddtMaxWordsPerSegment,D.paddtMaxWordsPerSegment),(!Number.isFinite(a.paddtMaxWordsPerSegment)||a.paddtMaxWordsPerSegment<=0)&&(a.paddtMaxWordsPerSegment=D.paddtMaxWordsPerSegment),a}function z(r,o){const e=document.createElement("table");return e.className="dummy_row",e.setAttribute("width",`${r.papersizeWidth}px`),e.setAttribute("cellspacing","0"),e.setAttribute("cellpadding","0"),e.innerHTML=`<tr style="height:${m(o)}px;"><td style="border:0px solid black;"></td></tr>`,e}function se(r){const o=document.createElement("table");return o.className="dummy_row_item",o.setAttribute("width",`${r.papersizeWidth}px`),o.setAttribute("cellspacing","0"),o.setAttribute("cellpadding","0"),r.customDummyRowItemContent?o.innerHTML=r.customDummyRowItemContent:o.innerHTML=`<tr style="height:${m(r.heightOfDummyRowItem)}px;"><td style="border:0px solid black;"></td></tr>`,o}function v(r,o,e){const t=m(r.heightOfDummyRowItem),a=m(e);if(t<=0||a<=0)return;const i=Math.floor(a/t);for(let n=0;n<i;n+=1)o.appendChild(se(r))}function pe(r,o,e){const t=m(e);t<=0||o.appendChild(z(r,t))}function le(r,o,e,t,a){if(!r.insertDummyRowItemWhileFormatTable)return a&&console.log("[printform] applyDummyRowItemsStep: SKIPPED (insertDummyRowItemWhileFormatTable=false)"),m(t);const i=m(e-t);if(a&&(console.log("[printform] applyDummyRowItemsStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   remaining: ${i}px, itemHeight: ${r.heightOfDummyRowItem}px`)),i>0){v(r,o,i);const n=m(r.heightOfDummyRowItem);if(n>0){const s=Math.floor(i/n),l=m(i%n),p=m(e-l);return a&&(console.log(`[printform]   inserted ${s} dummy_row_items (${s} x ${n}px = ${s*n}px)`),console.log(`[printform]   remainder: ${l}px, newHeight: ${p}px`)),p}}return m(t)}function ce(r,o,e,t,a){if(!r.insertDummyRowWhileFormatTable)return a&&console.log("[printform] applyDummyRowStep: SKIPPED (insertDummyRowWhileFormatTable=false)"),m(t);const i=m(e-t);return a&&(console.log("[printform] applyDummyRowStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   remaining: ${i}px`)),i>0?(pe(r,o,i),a&&console.log(`[printform]   inserted 1 dummy_row with height: ${i}px`),m(t+i)):m(t)}function de(r,o,e,t,a,i){if(!r.insertFooterSpacerWithDummyRowItemWhileFormatTable||a)return i&&console.log(`[printform] applyFooterSpacerWithDummyStep: SKIPPED (flag=${r.insertFooterSpacerWithDummyRowItemWhileFormatTable}, skipDummy=${a})`),{currentHeight:m(t),skipFooterSpacer:!1};const n=m(e-t);let s=m(t);if(i&&(console.log("[printform] applyFooterSpacerWithDummyStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   remaining: ${n}px`)),n>0){v(r,o,n);const l=m(r.heightOfDummyRowItem);if(l>0){const p=Math.floor(n/l),c=m(n%l);s=m(e-c),i&&console.log(`[printform]   inserted ${p} spacer dummy_row_items, remainder: ${c}px`)}}return{currentHeight:s,skipFooterSpacer:!0}}function ue(r,o,e,t,a,i,n){if(!r.insertFooterSpacerWhileFormatTable){n&&console.log("[printform] applyFooterSpacerStep: SKIPPED (insertFooterSpacerWhileFormatTable=false)");return}const s=i.cloneNode(!0);let l=m(e-t);const p=a&&a.nonRepeating?m(a.nonRepeating):0;p>0&&(l-=p);const c=Math.max(0,l);s.style.height=`${c}px`,o.appendChild(s),n&&(console.log("[printform] applyFooterSpacerStep:"),console.log(`[printform]   heightPerPage: ${e}px, currentHeight: ${t}px`),console.log(`[printform]   nonRepeatingFooter: ${p}px`),console.log(`[printform]   pfooter_spacer height: ${c}px`))}function fe(r,o){!r||!o||r.classList.contains(`${o}_processed`)||(r.classList.remove(o),r.classList.add(`${o}_processed`))}function ge(r){if(!r)return 0;const o=r.offsetHeight||r.getBoundingClientRect().height,e=r.ownerDocument&&r.ownerDocument.defaultView||(typeof window<"u"?window:null);if(!e||!e.getComputedStyle)return m(o);const t=e.getComputedStyle(r),a=Number.parseFloat(t.marginTop)||0,i=Number.parseFloat(t.marginBottom)||0;return m(o+a+i)}function me(r){const o=document.createElement("div");o.classList.add("div_page_break_before"),o.setAttribute("style","page-break-before: always; font-size: 0pt; height: 0px;");const e=typeof window<"u"?window:globalThis,t=typeof r=="string"&&r.trim()?r:e&&typeof e.__printFormDividerClassAppend=="string"?e.__printFormDividerClassAppend:"";return t&&t.split(/\s+/).filter(Boolean).forEach(a=>o.classList.add(a)),o}function he(r,o,e,t){if(!o)return null;const a=o.cloneNode(!0);return r.appendChild(a),e&&e(`append ${t}`),a}function ye(r,o,e,t,a){if(!o)return;const i=o.cloneNode(!0);r.appendChild(i),e&&e(`append ${a||"prowitem"} ${t}`)}const f={markAsProcessed:fe,measureHeight:ge,createPageBreakDivider:me,appendClone:he,appendRowItem:ye,createDummyRowTable:z};function Pe(r){r.prototype.initializeOutputContainer=function(){const e=document.createElement("div");return e.classList.add("printform_formatter"),this.formEl.parentNode.insertBefore(e,this.formEl),e},r.prototype.initializePhysicalWrapper=function(e){this.currentPhysicalWrapper?(e.appendChild(f.createPageBreakDivider()),this.currentPhysicalPage+=1):this.currentPhysicalPage=1;const t=document.createElement("div");return t.classList.add("physical_page_wrapper"),t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start",t.style.width=`${this.config.papersizeWidth}px`,e.appendChild(t),this.currentPhysicalWrapper=t,this.pagesInCurrentPhysical=0,t},r.prototype.ensureCurrentPageContainer=function(e){return this.currentPhysicalWrapper||this.initializePhysicalWrapper(e),this.currentPageContainer||this.createNewLogicalPage(e),this.currentPageContainer},r.prototype.createNewLogicalPage=function(e){(!this.currentPhysicalWrapper||this.pagesInCurrentPhysical>=this.nUp)&&this.initializePhysicalWrapper(e);const t=document.createElement("div");return t.classList.add("printform_page"),t.style.width=`${this.config.papersizeWidth}px`,this.currentPhysicalWrapper.appendChild(t),this.currentPageContainer=t,this.pagesInCurrentPhysical+=1,this.logicalPageToPhysicalPage[this.currentPage]=this.currentPhysicalPage,t},r.prototype.getCurrentPageContainer=function(e){return this.ensureCurrentPageContainer(e)},r.prototype.finalizePageHeight=function(e){if(!e)return;const t=this.config.papersizeHeight,a=this.config.fillPageHeightAfterFooter!==!1;let i=0;if(a){const n=f.measureHeight(e),s=Math.max(0,t-n);if(s>0){const l=f.createDummyRowTable(this.config,s);l.classList.add("dummy_spacer");const p=I.map(d=>`.${d.className}_processed`).concat([`.${k.className}_processed`,`.${C.className}_processed`]),c=e.querySelector(p.join(", "));c&&c.parentNode===e?e.insertBefore(l,c):e.appendChild(l),i=s}}if(this.debug){console.log(`
[printform] ========== PAGE HEIGHT CALCULATION ==========`),console.log(`[printform] Configured page height: ${t}px`),console.log("[printform] -------------------------------------------");const n=Array.from(e.children);let s=0;if(console.log(`[printform] Elements breakdown (${n.length} elements):`),n.forEach((l,p)=>{const c=f.measureHeight(l);s+=c;const d=l.className||"(no class)",g=l.tagName.toLowerCase();console.log(`[printform]   ${p+1}. <${g}.${d}>`),console.log(`[printform]      Height: ${c}px`),console.log(`[printform]      Cumulative: ${s}px`),console.log(`[printform]      Remaining: ${Math.max(0,t-s)}px`),c>t*.5&&console.log("[printform]      ⚠️  WARNING: Element height is > 50% of page height")}),console.log("[printform] -------------------------------------------"),console.log(`[printform] Total content height: ${s}px`),s<t){const l=t-s;console.log(`[printform] ✓ Content fits (${l}px under limit)`)}else if(s>t){const l=s-t;console.log(`[printform] ⚠️  Content overflow (${l}px over limit)`)}else console.log("[printform] ✓ Perfect fit (exactly matches configured height)");i>0&&console.log(`[printform] ✓ Final spacer appended: ${i}px`)}if(this.debug){const n=f.measureHeight(e);console.log("[printform] -------------------------------------------"),console.log(`[printform] Actual measured height: ${n}px`),console.log("[printform] ℹ️  Height NOT set - using natural content height"),console.log(`[printform] ===============================================
`)}}}const we=".prowitem, .ptac-rowitem, .paddt-rowitem",_e=200,be=200;function Se(r){var o=[];if(!r||!r.ownerDocument||!r.ownerDocument.createTreeWalker)return o;for(var e=r.ownerDocument.createTreeWalker(r,4,null,!1),t=e.nextNode();t;){for(var a=t.nodeValue||"",i=/\S+/g,n=i.exec(a);n;)o.push({node:t,start:n.index,end:n.index+n[0].length}),n=i.exec(a);t=e.nextNode()}return o}function Ne(r,o){var e=r.cloneNode(!1);return e.appendChild(o.cloneContents()),e.outerHTML||""}function O(r,o){if(!r)return[];if(!o||o<=0)return[r.outerHTML||""];var e=(r.textContent||"").trim();if(!e)return[r.outerHTML||""];if(!r.ownerDocument||!r.ownerDocument.createRange||!r.ownerDocument.createTreeWalker)return[r.outerHTML||""];var t=Se(r);if(t.length===0)return[r.outerHTML||""];if(t.length<=o)return[r.outerHTML||""];for(var a=[],i=0;i<t.length;i+=o){var n=i+o-1;n>=t.length&&(n=t.length-1);var s=r.ownerDocument.createRange();if(i===0)s.setStart(r,0);else{var l=t[i];s.setStart(l.node,l.start)}if(n+1<t.length){var p=t[n+1];s.setEnd(p.node,p.start)}else s.setEnd(r,r.childNodes.length);a.push(Ne(r,s))}return a}function Re(r,o){return O(r,o)}function De(r){r.prototype.collectSections=function(){this.expandPaddtSegments(),this.expandPtacSegments();const e=ee.map(s=>{const l=this.formEl.querySelector(`.${s.className}`);return l?{key:s.key,className:s.className,repeatFlag:s.repeatFlag,element:l}:null}).filter(Boolean),t=I.map(s=>{const l=this.formEl.querySelector(`.${s.className}`);return l?{key:s.key,className:s.className,repeatFlag:s.repeatFlag,element:l}:null}).filter(Boolean),a=Array.from(this.formEl.querySelectorAll(we)),i=a.filter(s=>this.isPaddtRow(s)),n=a.filter(s=>!this.isPaddtRow(s));return this.paddtRows=i,{header:this.formEl.querySelector(".pheader"),docInfos:e,rowHeader:this.formEl.querySelector(".prowheader"),footerVariants:t,footerLogo:this.formEl.querySelector(`.${k.className}`),footerPagenum:this.formEl.querySelector(`.${C.className}`),rows:n}},r.prototype.measureSections=function(e){const t={header:f.measureHeight(e.header),docInfos:{},rowHeader:f.measureHeight(e.rowHeader),footerVariants:{},footerLogo:f.measureHeight(e.footerLogo),footerPagenum:f.measureHeight(e.footerPagenum)};return e.docInfos.forEach(a=>{t.docInfos[a.key]=f.measureHeight(a.element)}),e.footerVariants.forEach(a=>{t.footerVariants[a.key]=f.measureHeight(a.element)}),t},r.prototype.markSectionsProcessed=function(e){f.markAsProcessed(e.header,"pheader"),e.docInfos.forEach(t=>{f.markAsProcessed(t.element,t.className)}),f.markAsProcessed(e.rowHeader,"prowheader"),e.footerVariants.forEach(t=>{f.markAsProcessed(t.element,t.className)}),f.markAsProcessed(e.footerLogo,k.className),f.markAsProcessed(e.footerPagenum,C.className)},r.prototype.createFooterSpacerTemplate=function(){const e=document.createElement("div");return e.classList.add("pfooter_spacer","paper_width"),e.style.height="0px",e}}function Fe(r){r.prototype.isPaddtRow=function(e){return e?e.classList.contains("paddt_segment")||e.classList.contains("paddt")||e.classList.contains("paddt-rowitem")||e.classList.contains("paddt-rowitem_processed"):!1},r.prototype.isPtacRow=function(e){return e?e.classList.contains("ptac_segment")||e.classList.contains("ptac")||e.classList.contains("ptac-rowitem")||e.classList.contains("ptac-rowitem_processed"):!1},r.prototype.getRowBaseClass=function(e){return e?this.isPaddtRow(e)?"paddt-rowitem":this.isPtacRow(e)?"ptac-rowitem":"prowitem":"prowitem"},r.prototype.shouldSkipRowHeaderForRow=function(e){return!e||!this.config.repeatRowheader?!1:e.classList.contains("without_prowheader")||e.classList.contains("tb_without_rowheader")?!0:this.isPtacRow(e)?!this.config.repeatPtacRowheader:this.isPaddtRow(e)?!(this.paddtConfig&&this.paddtConfig.repeatPaddtRowheader):!1},r.prototype.shouldSkipDummyRowItemsForContext=function(e){return!!(e&&(e.isPtacPage&&!this.config.insertPtacDummyRowItems||e.isPaddtPage&&!(this.paddtConfig&&this.paddtConfig.insertPaddtDummyRowItems)))}}function ke(r){r.prototype.expandPaddtSegments=function(){if(this.formEl.dataset.paddtExpanded==="true")return;const e=Array.from(this.formEl.querySelectorAll(".paddt"));if(e.length===0){this.formEl.dataset.paddtExpanded="true";return}var t=this.paddtConfig&&this.paddtConfig.paddtMaxWordsPerSegment||be;e.forEach(a=>{if(!a||a.dataset.paddtSegment==="true")return;const i=a.querySelector("td > div")||a.querySelector("td");if(!i){a.classList.add("paddt-rowitem","paddt_segment"),a.dataset.paddtSegment="true";return}const n=Array.from(i.children);if(n.length===0){a.classList.add("paddt-rowitem","paddt_segment"),a.dataset.paddtSegment="true";return}const s=[];if(n.forEach(c=>{c.tagName.toLowerCase()==="p"?Re(c,t).forEach(g=>s.push(g)):s.push(c.outerHTML)}),s.length===0){a.classList.add("paddt-rowitem","paddt_segment"),a.dataset.paddtSegment="true";return}i.innerHTML=s[0],a.classList.add("paddt-rowitem","paddt_segment"),a.dataset.paddtSegment="true";for(var l=a,p=1;p<s.length;p+=1){const c=a.cloneNode(!0);c.dataset.paddtSegment="true";const d=c.querySelector("td > div")||c.querySelector("td");d&&(d.innerHTML=s[p]),l.parentNode.insertBefore(c,l.nextSibling),l=c}}),this.formEl.dataset.paddtExpanded="true"}}function Ce(r){r.prototype.expandPtacSegments=function(){if(this.formEl.dataset.ptacExpanded==="true")return;const e=Array.from(this.formEl.querySelectorAll(".ptac"));if(e.length===0){this.formEl.dataset.ptacExpanded="true";return}e.forEach(t=>{if(!t||t.dataset.ptacSegment==="true")return;const a=t.querySelector("td > div")||t.querySelector("td");if(!a){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}const i=Array.from(a.children);if(i.length===0){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}const n=[];if(i.forEach(p=>{p.tagName.toLowerCase()==="p"?O(p,_e).forEach(d=>n.push(d)):n.push(p.outerHTML)}),n.length===0){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}a.innerHTML=n[0],t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";for(var s=t,l=1;l<n.length;l+=1){const p=t.cloneNode(!0);p.classList.remove("tb_page_break_before"),p.dataset.ptacSegment="true";const c=p.querySelector("td > div")||p.querySelector("td");c&&(c.innerHTML=n[l]),s.parentNode.insertBefore(p,s.nextSibling),s=p}}),this.formEl.dataset.ptacExpanded="true"}}function He(r){r.prototype.ensureFirstPageSections=function(e,t,a,i,n){let s=0;return t.header&&(f.appendClone(e,t.header,i,"pheader"),this.config.repeatHeader||(s+=a.header)),t.docInfos.forEach(l=>{const p=f.appendClone(e,l.element,i,l.className);this.registerPageNumberClone(p),this.config[l.repeatFlag]||(s+=a.docInfos[l.key]||0)}),t.rowHeader&&!n&&(f.appendClone(e,t.rowHeader,i,"prowheader"),this.config.repeatRowheader||(s+=a.rowHeader)),s},r.prototype.appendRepeatingSections=function(e,t,a,i){this.config.repeatHeader&&f.appendClone(e,t.header,a,"pheader"),t.docInfos.forEach(n=>{if(this.config[n.repeatFlag]){const s=f.appendClone(e,n.element,a,n.className);this.registerPageNumberClone(s)}}),this.config.repeatRowheader&&!i&&f.appendClone(e,t.rowHeader,a,"prowheader")},r.prototype.registerPageNumberClone=function(e){if(!e)return!1;let t=!1;if(this.showLogicalPageNumber&&e.querySelector("[data-page-number], [data-page-total], [data-page-number-container]")&&(K(e,this.currentPage,null),this.logicalPageNumberClones.push({node:e,pageNumber:this.currentPage}),t=!0),this.showPhysicalPageNumber&&e.querySelector("[data-physical-page-number], [data-physical-page-total], [data-physical-page-number-container]")){const a=this.logicalPageToPhysicalPage[this.currentPage]||this.currentPhysicalPage||1;A(e,a,null),this.physicalPageNumberClones.push({node:e,pageNumber:a}),t=!0}return t},r.prototype.appendRepeatingFooters=function(e,t,a){t.footerVariants.forEach(i=>{this.config[i.repeatFlag]&&f.appendClone(e,i.element,a,i.className)}),this.config.repeatFooterLogo&&f.appendClone(e,t.footerLogo,a,k.className),this.config.repeatFooterPagenum&&this.appendFooterPageNumber(e,t,a)},r.prototype.appendFinalFooters=function(e,t,a){t.footerVariants.forEach(i=>{f.appendClone(e,i.element,a,i.className)}),f.appendClone(e,t.footerLogo,a,k.className),this.appendFooterPageNumber(e,t,a)},r.prototype.appendFooterPageNumber=function(e,t,a){if(!t.footerPagenum)return;const i=t.footerPagenum.cloneNode(!0);e.appendChild(i),this.registerPageNumberClone(i),a&&a(`append ${C.className} page ${this.currentPage}`)},r.prototype.updatePageNumberTotals=function(){if(!this.logicalPageNumberClones.length&&!this.physicalPageNumberClones.length)return;const e=this.currentPage,t=this.currentPhysicalPage||1;this.logicalPageNumberClones.forEach(a=>{K(a.node,a.pageNumber,e)}),this.physicalPageNumberClones.forEach(a=>{A(a.node,a.pageNumber,t)})}}function Le(r){r.prototype.initializePageContext=function(e){return{baseLimit:e,limit:e,skipRowHeader:!1,isPtacPage:!1,isPaddtPage:!1}},r.prototype.refreshPageContextForRow=function(e,t,a){if(!e)return e;const i=this.shouldSkipRowHeaderForRow(t),n=a.rowHeader||0;return e.skipRowHeader=i,e.isPtacPage=this.isPtacRow(t),e.isPaddtPage=this.isPaddtRow(t),e.limit=e.baseLimit+(i?n:0),e},r.prototype.renderRows=function(e,t,a,i,n,s,l){let p=0;const c=this.initializePageContext(n);return this.debug&&(console.log("[printform] ===== renderRows START ====="),console.log(`[printform] Total rows: ${t.rows.length}, heightPerPage: ${n}px`)),t.rows.forEach((d,g)=>{const h=f.measureHeight(d),P=this.getRowBaseClass(d),N=this.isPtacRow(d),R=this.isPaddtRow(d);if(!h){f.markAsProcessed(d,P);return}if(p===0){this.refreshPageContextForRow(c,d,a);const b=this.getCurrentPageContainer(e);p+=this.ensureFirstPageSections(b,t,a,l,c.skipRowHeader),this.debug&&console.log(`[printform] Page ${this.currentPage} start: firstSectionHeight=${p}px, pageLimit=${c.limit}px`)}if(p+=h,this.debug&&console.log(`[printform]   row[${g}] height=${h}px, currentHeight=${p}px, limit=${c.limit}px`),f.markAsProcessed(d,P),d.classList.contains("tb_page_break_before")){this.debug&&console.log(`[printform]   >> PAGE BREAK (tb_page_break_before) at row[${g}]`),p-=h;const b=this.shouldSkipDummyRowItemsForContext(c),x=this.shouldSkipRowHeaderForRow(d);p=this.prepareNextPage(e,t,l,c.limit,p,i,s,x,b),this.refreshPageContextForRow(c,d,a);const T=this.getCurrentPageContainer(e);f.appendRowItem(T,d,l,g,P),p=h,this.debug&&console.log(`[printform] Page ${this.currentPage} start: currentHeight=${p}px, limit=${c.limit}px`),N||(c.isPtacPage=!1),R||(c.isPaddtPage=!1)}else if(p<=c.limit){const b=this.getCurrentPageContainer(e);f.appendRowItem(b,d,l,g,P),N||(c.isPtacPage=!1),R||(c.isPaddtPage=!1)}else{p-=h,this.debug&&console.log(`[printform]   >> PAGE BREAK (overflow) at row[${g}]`);const b=this.shouldSkipDummyRowItemsForContext(c),x=this.shouldSkipRowHeaderForRow(d);p=this.prepareNextPage(e,t,l,c.limit,p,i,s,x,b),this.refreshPageContextForRow(c,d,a);const T=this.getCurrentPageContainer(e);f.appendRowItem(T,d,l,g,P),p=h,this.debug&&console.log(`[printform] Page ${this.currentPage} start: currentHeight=${p}px, limit=${c.limit}px`),N||(c.isPtacPage=!1),R||(c.isPaddtPage=!1)}}),this.debug&&console.log(`[printform] ===== renderRows END (page ${this.currentPage}, finalHeight=${p}px) =====`),{currentHeight:p,pageLimit:c.limit,isPtacPage:c.isPtacPage,isPaddtPage:c.isPaddtPage}},r.prototype.prepareNextPage=function(e,t,a,i,n,s,l,p,c){const d=this.getCurrentPageContainer(e),g=this.applyRemainderSpacing(d,i,n,s,l,{skipDummyRowItems:c});this.appendRepeatingFooters(d,t,a),this.currentPage+=1,this.currentPageContainer=null,this.createNewLogicalPage(e);const h=this.getCurrentPageContainer(e);return this.appendRepeatingSections(h,t,a,p),g},r.prototype.applyRemainderSpacing=function(e,t,a,i,n,s){const l=s&&s.skipDummyRowItems;let p=m(a);this.debug&&(console.log(`[printform] ----- applyRemainderSpacing (page ${this.currentPage}) -----`),console.log(`[printform]   heightPerPage: ${t}px, currentHeight: ${a}px`),console.log(`[printform]   skipDummyRowItems: ${l}`)),l||(p=le(this.config,e,t,p,this.debug)),p=ce(this.config,e,t,p,this.debug);const c=de(this.config,e,t,p,l,this.debug);return p=c.currentHeight,c.skipFooterSpacer||ue(this.config,e,t,p,i,n,this.debug),this.debug&&(console.log(`[printform]   finalHeight after spacing: ${p}px`),console.log("[printform] -----------------------------------------")),m(p)}}function Ee(r){r.prototype.computeHeightPerPage=function(e,t){let a=this.config.papersizeHeight;if(this.debug&&(console.log("[printform] ===== computeHeightPerPage ====="),console.log(`[printform] papersizeHeight (config): ${this.config.papersizeHeight}px`),console.log(`[printform] papersizeWidth (config): ${this.config.papersizeWidth}px`)),this.config.repeatHeader&&e.header&&(this.debug&&console.log(`[printform]   - repeatHeader: ${t.header}px`),a-=t.header),e.docInfos.forEach(i=>{if(this.config[i.repeatFlag]){const n=t.docInfos[i.key]||0;this.debug&&console.log(`[printform]   - repeat ${i.className}: ${n}px`),a-=n}}),this.config.repeatRowheader&&e.rowHeader&&(this.debug&&console.log(`[printform]   - repeatRowheader: ${t.rowHeader}px`),a-=t.rowHeader),e.footerVariants.forEach(i=>{if(this.config[i.repeatFlag]){const n=t.footerVariants[i.key]||0;this.debug&&console.log(`[printform]   - repeat ${i.className}: ${n}px`),a-=n}}),this.config.repeatFooterLogo&&e.footerLogo&&(this.debug&&console.log(`[printform]   - repeatFooterLogo: ${t.footerLogo}px`),a-=t.footerLogo),this.config.repeatFooterPagenum&&e.footerPagenum){const i=t.footerPagenum||0;this.debug&&console.log(`[printform]   - repeatFooterPagenum: ${i}px`),a-=i}return this.debug&&(console.log(`[printform] heightPerPage (available for content): ${Math.max(0,a)}px`),console.log("[printform] ================================")),Math.max(0,a)},r.prototype.computeFooterState=function(e,t){const a=t.footerLogo||0,i=t.footerPagenum||0,s=e.footerVariants.reduce((d,g)=>{const h=t.footerVariants[g.key]||0;return d+h},0)+a+i;let p=e.footerVariants.reduce((d,g)=>{const h=t.footerVariants[g.key]||0;return this.config[g.repeatFlag]?d+h:d},0);this.config.repeatFooterLogo&&(p+=a),this.config.repeatFooterPagenum&&(p+=i);const c=Math.max(0,s-p);return{totalFinal:s,repeating:p,nonRepeating:c}},r.prototype.finalizeDocument=function(e,t,a,i,n,s,l){const p=n?n.currentHeight:0,c=n&&n.pageLimit?n.pageLimit:i,d=!!(n&&(n.isPtacPage&&!this.config.insertPtacDummyRowItems||n.isPaddtPage&&!(this.paddtConfig&&this.paddtConfig.insertPaddtDummyRowItems))),g=a.totalFinal-a.repeating,h=p+g;if(h<=c){const R=this.getCurrentPageContainer(e);this.applyRemainderSpacing(R,c,h,a,s,{skipDummyRowItems:d}),this.appendFinalFooters(R,t,l);return}this.prepareNextPage(e,t,l,c,p,a,s,!1,d);const P=g,N=this.getCurrentPageContainer(e);this.applyRemainderSpacing(N,i,P,a,s,null),this.appendFinalFooters(N,t,l)}}class _{constructor(o,e){this.formEl=o,this.config=e,this.debug=!!e.debug,this.nUp=Math.max(1,Math.floor(Number(e.nUp||1))),this.showLogicalPageNumber=e.showLogicalPageNumber!==!1,this.showPhysicalPageNumber=!!e.showPhysicalPageNumber,this.paddtConfig=ne(o,{}),this.paddtDebug=!!this.paddtConfig.paddtDebug,this.currentPage=1,this.currentPhysicalPage=0,this.pagesInCurrentPhysical=0,this.currentPhysicalWrapper=null,this.currentPageContainer=null,this.logicalPageNumberClones=[],this.physicalPageNumberClones=[],this.logicalPageToPhysicalPage=[],this.debug&&(console.log("[printform] ===== PrintFormFormatter initialized ====="),console.log("[printform] debug mode: ON"),console.log(`[printform] config.debug raw value: ${e.debug}`))}log(o){this.debug&&console.log(`[printform] ${o}`)}format(){const o=this.debug?this.log.bind(this):null,e=this.initializeOutputContainer();this.ensureCurrentPageContainer(e);const t=this.collectSections(),a=this.measureSections(t),i=this.createFooterSpacerTemplate();this.markSectionsProcessed(t);const n=this.computeFooterState(t,a),s=this.computeHeightPerPage(t,a),l=this.renderRows(e,t,a,n,s,i,o);if(this.finalizeDocument(e,t,n,s,l,i,o),this.paddtRows&&this.paddtRows.length){this.currentPage+=1,this.currentPageContainer=null,this.initializePhysicalWrapper(e),this.createNewLogicalPage(e);var p={docInfo:this.paddtConfig.repeatPaddtDocinfo,docInfo002:this.paddtConfig.repeatPaddtDocinfo002,docInfo003:this.paddtConfig.repeatPaddtDocinfo003,docInfo004:this.paddtConfig.repeatPaddtDocinfo004,docInfo005:this.paddtConfig.repeatPaddtDocinfo005},c=t.docInfos.filter(function(R){var b=p[R.key];return b===void 0?!0:!!b});const g={header:t.header,docInfos:c,rowHeader:t.rowHeader,footerVariants:[],footerLogo:t.footerLogo,footerPagenum:t.footerPagenum,rows:this.paddtRows},h=this.computeFooterState(g,a),P=this.computeHeightPerPage(g,a),N=this.renderRows(e,g,a,h,P,i,o);this.finalizeDocument(e,g,h,P,N,i,o)}this.updatePageNumberTotals();const d=e.querySelectorAll(".printform_page");return this.debug&&console.log(`[printform] Finalizing heights for ${d.length} pages...`),d.forEach((g,h)=>{if(this.finalizePageHeight(g),this.debug){const P=g.style.height||"(auto)";console.log(`[printform]   Page ${h+1}: height style = ${P}`)}}),e.classList.remove("printform_formatter"),e.classList.add("printform_formatter_processed"),this.formEl.remove(),e}}Pe(_),De(_),Fe(_),ke(_),Ce(_),He(_),Le(_),Ee(_);function B(r,o,e){const t=r.__printFormDividerClassAppend;r.__printFormDividerClassAppend=typeof o=="string"?o:"";try{return e()}finally{t===void 0?delete r.__printFormDividerClassAppend:r.__printFormDividerClassAppend=t}}function xe(r){return new Promise((o,e)=>{setTimeout(o,r)})}async function q(r={}){const o=typeof window<"u"?window:globalThis;if(!o.__printFormProcessing&&!(!r.force&&o.__printFormProcessed)){o.__printFormProcessing=!0;try{const e=o.document;if(!e)return;const t=Array.from(e.querySelectorAll(".printform"));for(let a=0;a<t.length;a+=1){const i=t[a],n={...r};if(n.divPageBreakBeforeClassAppend===void 0&&i&&i.dataset){const p=i.dataset.divPageBreakBeforeClassAppend;typeof p=="string"&&p.trim()&&(n.divPageBreakBeforeClassAppend=p.trim())}const s=n.divPageBreakBeforeClassAppend,l=M(i,n);try{await xe(1)}catch(p){console.error("pauseInMilliseconds error",p)}try{const p=B(o,s,()=>new _(i,l).format());a>0&&p&&p.parentNode&&p.parentNode.insertBefore(f.createPageBreakDivider(s),p)}catch(p){console.error("printform format error",p)}}o.__printFormProcessed=!0}finally{o.__printFormProcessing=!1}}}function Te(r,o={}){const e=typeof window<"u"?window:globalThis,t={...o};if(t.divPageBreakBeforeClassAppend===void 0&&r&&r.dataset){const n=r.dataset.divPageBreakBeforeClassAppend;typeof n=="string"&&n.trim()&&(t.divPageBreakBeforeClassAppend=n.trim())}const a=t.divPageBreakBeforeClassAppend,i=M(r,t);return B(e,a,()=>new _(r,i).format())}const E={formatAll:q,format:Te,DEFAULT_CONFIG:y,DEFAULT_PADDT_CONFIG:D},S=typeof window<"u"?window:null;if(S)if(S.__printFormScriptLoaded__)S.PrintForm=S.PrintForm||E;else{S.__printFormScriptLoaded__=!0,S.PrintForm=S.PrintForm||{},Object.assign(S.PrintForm,E);const r=S.document;r&&r.addEventListener&&r.addEventListener("DOMContentLoaded",()=>{q()})}return E}();
