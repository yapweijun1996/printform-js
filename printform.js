var PrintForm=function(){"use strict";const v=new Set(["y","yes","true","1"]),q=new Set(["n","no","false","0"]);function d(o,e){if(o==null||o==="")return e;if(typeof o=="boolean")return o;if(typeof o=="number")return o!==0;const t=String(o).trim().toLowerCase();return v.has(t)?!0:q.has(t)?!1:e}function b(o,e){if(o==null||o==="")return e;const t=Number(o);return Number.isFinite(t)?t:e}function N(o,e){return o==null||o===""?e:String(o)}function B(o){const e=String(o||"").trim().toLowerCase();return e==="landscape"?"landscape":e==="portrait"?"portrait":""}function U(o){const e=String(o||"").trim();if(!e)return"";const t=e.toUpperCase();return t==="A4"||t==="A5"||t==="LETTER"||t==="LEGAL"?t:t==="US_LETTER"||t==="USLETTER"?"LETTER":t==="US_LEGAL"||t==="USLEGAL"?"LEGAL":""}function K(o,e){const t=Number(o),r=Number(e);return!Number.isFinite(t)||!Number.isFinite(r)||r<=0?0:Math.round(t/25.4*r)}const G={A4:{widthMm:210,heightMm:297},A5:{widthMm:148,heightMm:210},LETTER:{widthMm:215.9,heightMm:279.4},LEGAL:{widthMm:215.9,heightMm:355.6}};function j(o){const e=U(o&&o.paperSize);if(!e)return null;const t=G[e];if(!t)return null;const r=Number(o&&o.dpi),a=K(t.widthMm,r),i=K(t.heightMm,r);return!a||!i?null:(B(o&&o.orientation)||"portrait")==="landscape"?{width:i,height:a}:{width:a,height:i}}function m(o){const e=Number(o);return Number.isFinite(e)?Math.max(0,Math.round(e)):0}function X(o){if(!o)return null;if(o.__pageNumberPlaceholder)return o.__pageNumberPlaceholder;const e=o.ownerDocument||(typeof document<"u"?document:null);if(!e)return null;let t=o.querySelector("[data-page-number-container]");t||(t=o.querySelector("td:last-child")||o.querySelector("td")||o);const r=e.createElement("span");return r.className="printform_page_number_placeholder",t.appendChild(r),o.__pageNumberPlaceholder=r,r}function Z(o){if(!o)return null;if(o.__physicalPageNumberPlaceholder)return o.__physicalPageNumberPlaceholder;const e=o.ownerDocument||(typeof document<"u"?document:null);if(!e)return null;let t=o.querySelector("[data-physical-page-number-container]");t||(t=o.querySelector("td:last-child")||o.querySelector("td")||o);const r=e.createElement("span");return r.className="printform_physical_page_number_placeholder",t.appendChild(r),o.__physicalPageNumberPlaceholder=r,r}function T(o,e,t){if(!o)return;const r=o.querySelectorAll("[data-page-number]");r.length>0&&r.forEach(function(n){n.textContent=e});const a=o.querySelectorAll("[data-page-total]"),i=t??"";if(a.length>0&&a.forEach(function(n){n.textContent=i}),r.length===0&&a.length===0){const n=X(o);n&&(n.textContent=t!=null?"Page "+e+" of "+t:"Page "+e)}}function x(o,e,t){if(!o)return;const r=o.querySelectorAll("[data-physical-page-number]");r.length>0&&r.forEach(function(n){n.textContent=e});const a=o.querySelectorAll("[data-physical-page-total]"),i=t??"";if(a.length>0&&a.forEach(function(n){n.textContent=i}),r.length===0&&a.length===0){const n=Z(o);n&&(n.textContent=t!=null?"Sheet "+e+" of "+t:"Sheet "+e)}}const C=[{key:"papersizeWidth",datasetKey:"papersizeWidth",legacyKey:"papersize_width",defaultValue:750,parser:b},{key:"papersizeHeight",datasetKey:"papersizeHeight",legacyKey:"papersize_height",defaultValue:1050,parser:b},{key:"paperSize",datasetKey:"paperSize",legacyKey:"paper_size",defaultValue:"",parser:N},{key:"orientation",datasetKey:"orientation",legacyKey:"orientation",defaultValue:"portrait",parser:N},{key:"dpi",datasetKey:"dpi",legacyKey:"dpi",defaultValue:96,parser:b},{key:"nUp",datasetKey:"nUp",legacyKey:"n_up",defaultValue:1,parser:b},{key:"showLogicalPageNumber",datasetKey:"showLogicalPageNumber",legacyKey:"show_logical_page_number",defaultValue:!0,parser:d},{key:"showPhysicalPageNumber",datasetKey:"showPhysicalPageNumber",legacyKey:"show_physical_page_number",defaultValue:!1,parser:d},{key:"heightOfDummyRowItem",datasetKey:"heightOfDummyRowItem",legacyKey:"height_of_dummy_row_item",defaultValue:18,parser:b},{key:"repeatHeader",datasetKey:"repeatHeader",legacyKey:"repeat_header",defaultValue:!0,parser:d},{key:"repeatDocinfo",datasetKey:"repeatDocinfo",legacyKey:"repeat_docinfo",defaultValue:!0,parser:d},{key:"repeatDocinfo002",datasetKey:"repeatDocinfo002",legacyKey:"repeat_docinfo002",defaultValue:!0,parser:d},{key:"repeatDocinfo003",datasetKey:"repeatDocinfo003",legacyKey:"repeat_docinfo003",defaultValue:!0,parser:d},{key:"repeatDocinfo004",datasetKey:"repeatDocinfo004",legacyKey:"repeat_docinfo004",defaultValue:!0,parser:d},{key:"repeatDocinfo005",datasetKey:"repeatDocinfo005",legacyKey:"repeat_docinfo005",defaultValue:!0,parser:d},{key:"repeatRowheader",datasetKey:"repeatRowheader",legacyKey:"repeat_rowheader",defaultValue:!0,parser:d},{key:"repeatPtacRowheader",datasetKey:"repeatPtacRowheader",legacyKey:"repeat_ptac_rowheader",defaultValue:!0,parser:d},{key:"repeatFooter",datasetKey:"repeatFooter",legacyKey:"repeat_footer",defaultValue:!1,parser:d},{key:"repeatFooter002",datasetKey:"repeatFooter002",legacyKey:"repeat_footer002",defaultValue:!1,parser:d},{key:"repeatFooter003",datasetKey:"repeatFooter003",legacyKey:"repeat_footer003",defaultValue:!1,parser:d},{key:"repeatFooter004",datasetKey:"repeatFooter004",legacyKey:"repeat_footer004",defaultValue:!1,parser:d},{key:"repeatFooter005",datasetKey:"repeatFooter005",legacyKey:"repeat_footer005",defaultValue:!1,parser:d},{key:"repeatFooterLogo",datasetKey:"repeatFooterLogo",legacyKey:"repeat_footer_logo",defaultValue:!1,parser:d},{key:"repeatFooterPagenum",datasetKey:"repeatFooterPagenum",legacyKey:"repeat_footer_pagenum",defaultValue:!1,parser:d},{key:"insertDummyRowItemWhileFormatTable",datasetKey:"insertDummyRowItemWhileFormatTable",legacyKey:"insert_dummy_row_item_while_format_table",defaultValue:!0,parser:d},{key:"insertPtacDummyRowItems",datasetKey:"insertPtacDummyRowItems",legacyKey:"insert_ptac_dummy_row_items",defaultValue:!0,parser:d},{key:"insertDummyRowWhileFormatTable",datasetKey:"insertDummyRowWhileFormatTable",legacyKey:"insert_dummy_row_while_format_table",defaultValue:!1,parser:d},{key:"insertFooterSpacerWhileFormatTable",datasetKey:"insertFooterSpacerWhileFormatTable",legacyKey:"insert_footer_spacer_while_format_table",defaultValue:!0,parser:d},{key:"insertFooterSpacerWithDummyRowItemWhileFormatTable",datasetKey:"insertFooterSpacerWithDummyRowItemWhileFormatTable",legacyKey:"insert_footer_spacer_with_dummy_row_item_while_format_table",defaultValue:!0,parser:d},{key:"customDummyRowItemContent",datasetKey:"customDummyRowItemContent",legacyKey:"custom_dummy_row_item_content",defaultValue:"",parser:N},{key:"debug",datasetKey:"debug",legacyKey:"debug_printform",defaultValue:!1,parser:d}],J=[{key:"docInfo",className:"pdocinfo",repeatFlag:"repeatDocinfo"},{key:"docInfo002",className:"pdocinfo002",repeatFlag:"repeatDocinfo002"},{key:"docInfo003",className:"pdocinfo003",repeatFlag:"repeatDocinfo003"},{key:"docInfo004",className:"pdocinfo004",repeatFlag:"repeatDocinfo004"},{key:"docInfo005",className:"pdocinfo005",repeatFlag:"repeatDocinfo005"}],Q=[{key:"footer",className:"pfooter",repeatFlag:"repeatFooter"},{key:"footer002",className:"pfooter002",repeatFlag:"repeatFooter002"},{key:"footer003",className:"pfooter003",repeatFlag:"repeatFooter003"},{key:"footer004",className:"pfooter004",repeatFlag:"repeatFooter004"},{key:"footer005",className:"pfooter005",repeatFlag:"repeatFooter005"}],R={className:"pfooter_logo"},L={className:"pfooter_pagenum"},_=C.reduce((o,e)=>(o[e.key]=e.defaultValue,o),{});function $(o){const e=typeof window<"u"?window:typeof globalThis<"u"?globalThis:{};return o.reduce((t,r)=>{if(!r.legacyKey)return t;const a=e[r.legacyKey];return a==null||a===""||(t[r.key]=r.parser(a,r.defaultValue)),t},{})}function I(o,e){const t=e||{};return o.reduce((r,a)=>{if(!a.datasetKey||!Object.prototype.hasOwnProperty.call(t,a.datasetKey))return r;const i=t[a.datasetKey];return i==null||i===""||(r[a.key]=a.parser(i,a.defaultValue)),r},{})}function Y(){return $(C)}function ee(o){return I(C,o)}function te(o,e){const t=o.querySelector("template.custom-dummy-row-item-content");return t?t.innerHTML.trim():e}function V(o,e={}){const t=Y(),r=ee(o.dataset||{}),a={..._,...t,...r,...e};a.customDummyRowItemContent=te(o,e.customDummyRowItemContent!==void 0?e.customDummyRowItemContent:a.customDummyRowItemContent),a.debug=d(a.debug,_.debug),a.nUp=b(a.nUp,_.nUp),(!Number.isFinite(a.nUp)||a.nUp<1)&&(a.nUp=_.nUp),a.nUp=Math.floor(a.nUp),a.showLogicalPageNumber=d(a.showLogicalPageNumber,_.showLogicalPageNumber),a.showPhysicalPageNumber=d(a.showPhysicalPageNumber,_.showPhysicalPageNumber),a.papersizeWidth=b(a.papersizeWidth,_.papersizeWidth),a.papersizeHeight=b(a.papersizeHeight,_.papersizeHeight),a.paperSize=N(a.paperSize,_.paperSize),a.orientation=N(a.orientation,_.orientation),a.dpi=b(a.dpi,_.dpi),(!Number.isFinite(a.dpi)||a.dpi<=0)&&(a.dpi=_.dpi);const i=s=>Object.prototype.hasOwnProperty.call(e,s)&&e[s]!=="",n=Object.prototype.hasOwnProperty.call(t,"papersizeWidth")||Object.prototype.hasOwnProperty.call(r,"papersizeWidth")||i("papersizeWidth"),l=Object.prototype.hasOwnProperty.call(t,"papersizeHeight")||Object.prototype.hasOwnProperty.call(r,"papersizeHeight")||i("papersizeHeight");if(!n&&!l){const s=j({paperSize:a.paperSize,orientation:a.orientation,dpi:a.dpi});s&&(a.papersizeWidth=s.width,a.papersizeHeight=s.height)}return a}const H=[{key:"repeatPaddt",datasetKey:"repeatPaddt",legacyKey:"repeat_paddt",defaultValue:!0,parser:d},{key:"insertPaddtDummyRowItems",datasetKey:"insertPaddtDummyRowItems",legacyKey:"insert_paddt_dummy_row_items",defaultValue:!0,parser:d},{key:"paddtMaxWordsPerSegment",datasetKey:"paddtMaxWordsPerSegment",legacyKey:"paddt_max_words_per_segment",defaultValue:200,parser:b},{key:"repeatPaddtRowheader",datasetKey:"repeatPaddtRowheader",legacyKey:"repeat_paddt_rowheader",defaultValue:!0,parser:d},{key:"paddtDebug",datasetKey:"paddtDebug",legacyKey:"paddt_debug",defaultValue:!1,parser:d},{key:"repeatPaddtDocinfo",datasetKey:"repeatPaddtDocinfo",legacyKey:"repeat_paddt_docinfo",defaultValue:!0,parser:d},{key:"repeatPaddtDocinfo002",datasetKey:"repeatPaddtDocinfo002",legacyKey:"repeat_paddt_docinfo002",defaultValue:!0,parser:d},{key:"repeatPaddtDocinfo003",datasetKey:"repeatPaddtDocinfo003",legacyKey:"repeat_paddt_docinfo003",defaultValue:!0,parser:d},{key:"repeatPaddtDocinfo004",datasetKey:"repeatPaddtDocinfo004",legacyKey:"repeat_paddt_docinfo004",defaultValue:!0,parser:d},{key:"repeatPaddtDocinfo005",datasetKey:"repeatPaddtDocinfo005",legacyKey:"repeat_paddt_docinfo005",defaultValue:!0,parser:d}],F=H.reduce(function(o,e){return o[e.key]=e.defaultValue,o},{});function re(){return $(H)}function ae(o){return I(H,o)}function oe(o,e){e=e||{};var t=re(),r=ae(o&&o.dataset||{}),a={};for(var i in F)Object.prototype.hasOwnProperty.call(F,i)&&(a[i]=F[i]);for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n]);for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(a[l]=r[l]);for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(a[s]=e[s]);return a.paddtDebug=d(a.paddtDebug,F.paddtDebug),a.paddtMaxWordsPerSegment=b(a.paddtMaxWordsPerSegment,F.paddtMaxWordsPerSegment),(!Number.isFinite(a.paddtMaxWordsPerSegment)||a.paddtMaxWordsPerSegment<=0)&&(a.paddtMaxWordsPerSegment=F.paddtMaxWordsPerSegment),a}function ie(o,e){const t=document.createElement("table");return t.className="dummy_row",t.setAttribute("width",`${o.papersizeWidth}px`),t.setAttribute("cellspacing","0"),t.setAttribute("cellpadding","0"),t.innerHTML=`<tr style="height:${m(e)}px;"><td style="border:0px solid black;"></td></tr>`,t}function ne(o){const e=document.createElement("table");return e.className="dummy_row_item",e.setAttribute("width",`${o.papersizeWidth}px`),e.setAttribute("cellspacing","0"),e.setAttribute("cellpadding","0"),o.customDummyRowItemContent?e.innerHTML=o.customDummyRowItemContent:e.innerHTML=`<tr style="height:${m(o.heightOfDummyRowItem)}px;"><td style="border:0px solid black;"></td></tr>`,e}function W(o,e,t){const r=m(o.heightOfDummyRowItem),a=m(t);if(r<=0||a<=0)return;const i=Math.floor(a/r);for(let n=0;n<i;n+=1)e.appendChild(ne(o))}function se(o,e,t){const r=m(t);r<=0||e.appendChild(ie(o,r))}function le(o,e,t,r,a){if(!o.insertDummyRowItemWhileFormatTable)return a&&console.log("[printform] applyDummyRowItemsStep: SKIPPED (insertDummyRowItemWhileFormatTable=false)"),m(r);const i=m(t-r);if(a&&(console.log("[printform] applyDummyRowItemsStep:"),console.log(`[printform]   heightPerPage: ${t}px, currentHeight: ${r}px`),console.log(`[printform]   remaining: ${i}px, itemHeight: ${o.heightOfDummyRowItem}px`)),i>0){W(o,e,i);const n=m(o.heightOfDummyRowItem);if(n>0){const l=Math.floor(i/n),s=m(i%n),p=m(t-s);return a&&(console.log(`[printform]   inserted ${l} dummy_row_items (${l} x ${n}px = ${l*n}px)`),console.log(`[printform]   remainder: ${s}px, newHeight: ${p}px`)),p}}return m(r)}function pe(o,e,t,r,a){if(!o.insertDummyRowWhileFormatTable)return a&&console.log("[printform] applyDummyRowStep: SKIPPED (insertDummyRowWhileFormatTable=false)"),m(r);const i=m(t-r);return a&&(console.log("[printform] applyDummyRowStep:"),console.log(`[printform]   heightPerPage: ${t}px, currentHeight: ${r}px`),console.log(`[printform]   remaining: ${i}px`)),i>0?(se(o,e,i),a&&console.log(`[printform]   inserted 1 dummy_row with height: ${i}px`),m(r+i)):m(r)}function ce(o,e,t,r,a,i){if(!o.insertFooterSpacerWithDummyRowItemWhileFormatTable||a)return i&&console.log(`[printform] applyFooterSpacerWithDummyStep: SKIPPED (flag=${o.insertFooterSpacerWithDummyRowItemWhileFormatTable}, skipDummy=${a})`),{currentHeight:m(r),skipFooterSpacer:!1};const n=m(t-r);let l=m(r);if(i&&(console.log("[printform] applyFooterSpacerWithDummyStep:"),console.log(`[printform]   heightPerPage: ${t}px, currentHeight: ${r}px`),console.log(`[printform]   remaining: ${n}px`)),n>0){W(o,e,n);const s=m(o.heightOfDummyRowItem);if(s>0){const p=Math.floor(n/s),c=m(n%s);l=m(t-c),i&&console.log(`[printform]   inserted ${p} spacer dummy_row_items, remainder: ${c}px`)}}return{currentHeight:l,skipFooterSpacer:!0}}function de(o,e,t,r,a,i,n){if(!o.insertFooterSpacerWhileFormatTable){n&&console.log("[printform] applyFooterSpacerStep: SKIPPED (insertFooterSpacerWhileFormatTable=false)");return}const l=i.cloneNode(!0);let s=m(t-r);const p=a&&a.nonRepeating?m(a.nonRepeating):0;p>0&&(s-=p);const c=Math.max(0,s);l.style.height=`${c}px`,e.appendChild(l),n&&(console.log("[printform] applyFooterSpacerStep:"),console.log(`[printform]   heightPerPage: ${t}px, currentHeight: ${r}px`),console.log(`[printform]   nonRepeatingFooter: ${p}px`),console.log(`[printform]   pfooter_spacer height: ${c}px`))}function ue(o,e){!o||!e||o.classList.contains(`${e}_processed`)||(o.classList.remove(e),o.classList.add(`${e}_processed`))}function fe(o){if(!o)return 0;const e=o.offsetHeight||o.getBoundingClientRect().height,t=o.ownerDocument&&o.ownerDocument.defaultView||(typeof window<"u"?window:null);if(!t||!t.getComputedStyle)return m(e);const r=t.getComputedStyle(o),a=Number.parseFloat(r.marginTop)||0,i=Number.parseFloat(r.marginBottom)||0;return m(e+a+i)}function me(){const o=document.createElement("div");return o.classList.add("div_page_break_before"),o.style.pageBreakBefore="always",o.style.height="0px",o}function ge(o,e,t,r){if(!e)return null;const a=e.cloneNode(!0);return o.appendChild(a),t&&t(`append ${r}`),a}function he(o,e,t,r,a){if(!e)return;const i=e.cloneNode(!0);o.appendChild(i),t&&t(`append ${a||"prowitem"} ${r}`)}const u={markAsProcessed:ue,measureHeight:fe,createPageBreakDivider:me,appendClone:ge,appendRowItem:he},ye=".prowitem, .ptac-rowitem, .paddt-rowitem",Pe=200,we=200;function M(o,e){var t=o.cloneNode(!1);return t.textContent=e.join(" "),t.outerHTML||""}function A(o,e){if(!o)return[];var t=(o.textContent||"").trim();if(!t)return[o.outerHTML||""];var r=t.split(/\s+/).filter(function(l){return l&&l.length>0});if(r.length<=e)return[o.outerHTML||""];for(var a=[],i=[],n=0;n<r.length;n+=1)i.push(r[n]),i.length>=e&&(a.push(M(o,i)),i=[]);return i.length>0&&a.push(M(o,i)),a}function _e(o,e){return A(o,e)}class O{constructor(e,t){this.formEl=e,this.config=t,this.debug=!!t.debug,this.nUp=Math.max(1,Math.floor(Number(t.nUp||1))),this.showLogicalPageNumber=t.showLogicalPageNumber!==!1,this.showPhysicalPageNumber=!!t.showPhysicalPageNumber,this.paddtConfig=oe(e,{}),this.paddtDebug=!!this.paddtConfig.paddtDebug,this.currentPage=1,this.currentPhysicalPage=0,this.pagesInCurrentPhysical=0,this.currentPhysicalWrapper=null,this.currentPageContainer=null,this.logicalPageNumberClones=[],this.physicalPageNumberClones=[],this.logicalPageToPhysicalPage=[],this.debug&&(console.log("[printform] ===== PrintFormFormatter initialized ====="),console.log("[printform] debug mode: ON"),console.log(`[printform] config.debug raw value: ${t.debug}`))}log(e){this.debug&&console.log(`[printform] ${e}`)}initializeOutputContainer(){const e=document.createElement("div");return e.classList.add("printform_formatter"),this.formEl.parentNode.insertBefore(e,this.formEl),e}initializePhysicalWrapper(e){this.currentPhysicalWrapper?(e.appendChild(u.createPageBreakDivider()),this.currentPhysicalPage+=1):this.currentPhysicalPage=1;const t=document.createElement("div");return t.classList.add("physical_page_wrapper"),t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start",t.style.width=`${this.config.papersizeWidth}px`,e.appendChild(t),this.currentPhysicalWrapper=t,this.pagesInCurrentPhysical=0,t}ensureCurrentPageContainer(e){return this.currentPhysicalWrapper||this.initializePhysicalWrapper(e),this.currentPageContainer||this.createNewLogicalPage(e),this.currentPageContainer}createNewLogicalPage(e){(!this.currentPhysicalWrapper||this.pagesInCurrentPhysical>=this.nUp)&&this.initializePhysicalWrapper(e);const t=document.createElement("div");return t.classList.add("printform_page"),t.style.width=`${this.config.papersizeWidth}px`,t.style.minHeight=`${this.config.papersizeHeight}px`,this.currentPhysicalWrapper.appendChild(t),this.currentPageContainer=t,this.pagesInCurrentPhysical+=1,this.logicalPageToPhysicalPage[this.currentPage]=this.currentPhysicalPage,t}getCurrentPageContainer(e){return this.ensureCurrentPageContainer(e)}collectSections(){this.expandPaddtSegments(),this.expandPtacSegments();const e=J.map(n=>{const l=this.formEl.querySelector(`.${n.className}`);return l?{key:n.key,className:n.className,repeatFlag:n.repeatFlag,element:l}:null}).filter(Boolean),t=Q.map(n=>{const l=this.formEl.querySelector(`.${n.className}`);return l?{key:n.key,className:n.className,repeatFlag:n.repeatFlag,element:l}:null}).filter(Boolean),r=Array.from(this.formEl.querySelectorAll(ye)),a=r.filter(n=>this.isPaddtRow(n)),i=r.filter(n=>!this.isPaddtRow(n));return this.paddtRows=a,{header:this.formEl.querySelector(".pheader"),docInfos:e,rowHeader:this.formEl.querySelector(".prowheader"),footerVariants:t,footerLogo:this.formEl.querySelector(`.${R.className}`),footerPagenum:this.formEl.querySelector(`.${L.className}`),rows:i}}isPaddtRow(e){return e?e.classList.contains("paddt_segment")||e.classList.contains("paddt")||e.classList.contains("paddt-rowitem")||e.classList.contains("paddt-rowitem_processed"):!1}isPtacRow(e){return e?e.classList.contains("ptac_segment")||e.classList.contains("ptac")||e.classList.contains("ptac-rowitem")||e.classList.contains("ptac-rowitem_processed"):!1}getRowBaseClass(e){return e?this.isPaddtRow(e)?"paddt-rowitem":this.isPtacRow(e)?"ptac-rowitem":"prowitem":"prowitem"}shouldSkipRowHeaderForRow(e){return!e||!this.config.repeatRowheader?!1:this.isPtacRow(e)?!this.config.repeatPtacRowheader:this.isPaddtRow(e)?!(this.paddtConfig&&this.paddtConfig.repeatPaddtRowheader):!1}initializePageContext(e){return{baseLimit:e,limit:e,skipRowHeader:!1,isPtacPage:!1,isPaddtPage:!1}}refreshPageContextForRow(e,t,r){if(!e)return e;const a=this.shouldSkipRowHeaderForRow(t),i=r.rowHeader||0;return e.skipRowHeader=a,e.isPtacPage=this.isPtacRow(t),e.isPaddtPage=this.isPaddtRow(t),e.limit=e.baseLimit+(a?i:0),e}shouldSkipDummyRowItemsForContext(e){return!!(e&&(e.isPtacPage&&!this.config.insertPtacDummyRowItems||e.isPaddtPage&&!(this.paddtConfig&&this.paddtConfig.insertPaddtDummyRowItems)))}expandPaddtSegments(){if(this.formEl.dataset.paddtExpanded==="true")return;const e=Array.from(this.formEl.querySelectorAll(".paddt"));if(e.length===0){this.formEl.dataset.paddtExpanded="true";return}var t=this.paddtConfig&&this.paddtConfig.paddtMaxWordsPerSegment||we;e.forEach(r=>{if(!r||r.dataset.paddtSegment==="true")return;const a=r.querySelector("td > div")||r.querySelector("td");if(!a){r.classList.add("paddt-rowitem","paddt_segment"),r.dataset.paddtSegment="true";return}const i=Array.from(a.querySelectorAll("p"));var n=null;i.length>1&&(n=i.shift());const l=i;if(l.length===0){r.classList.add("paddt-rowitem","paddt_segment"),r.dataset.paddtSegment="true";return}const s=n?n.outerHTML:"",p=l.reduce(function(h,w){const D=_e(w,t);return h.concat(D)},[]);if(p.length===0){a.innerHTML=s,r.classList.add("paddt-rowitem","paddt_segment"),r.dataset.paddtSegment="true";return}const c=[];if(s){c.push(s+p[0]);for(var f=1;f<p.length;f+=1)c.push(p[f])}else for(var g=0;g<p.length;g+=1)c.push(p[g]);if(c.length===0){a.innerHTML=s,r.classList.add("paddt-rowitem","paddt_segment"),r.dataset.paddtSegment="true";return}a.innerHTML=c[0],r.classList.add("paddt-rowitem","paddt_segment"),r.dataset.paddtSegment="true";for(var P=r,y=1;y<c.length;y+=1){const h=r.cloneNode(!0);h.dataset.paddtSegment="true";const w=h.querySelector("td > div")||h.querySelector("td");w&&(w.innerHTML=c[y]),P.parentNode.insertBefore(h,P.nextSibling),P=h}}),this.formEl.dataset.paddtExpanded="true"}expandPtacSegments(){if(this.formEl.dataset.ptacExpanded==="true")return;const e=Array.from(this.formEl.querySelectorAll(".ptac"));if(e.length===0){this.formEl.dataset.ptacExpanded="true";return}e.forEach(t=>{if(!t||t.dataset.ptacSegment==="true")return;const r=t.querySelector("td > div")||t.querySelector("td");if(!r){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}const a=Array.from(r.querySelectorAll("p"));var i=null;a.length>1&&(i=a.shift());const n=a;if(n.length===0){t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}const l=i?i.outerHTML:"",s=n.reduce(function(y,h){const w=A(h,Pe);return y.concat(w)},[]);if(s.length===0){r.innerHTML=l,t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}const p=[];if(l){p.push(l+s[0]);for(var c=1;c<s.length;c+=1)p.push(s[c])}else for(var f=0;f<s.length;f+=1)p.push(s[f]);if(p.length===0){r.innerHTML=l,t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";return}r.innerHTML=p[0],t.classList.add("ptac-rowitem","ptac_segment"),t.dataset.ptacSegment="true";for(var g=t,P=1;P<p.length;P+=1){const y=t.cloneNode(!0);y.dataset.ptacSegment="true";const h=y.querySelector("td > div")||y.querySelector("td");h&&(h.innerHTML=p[P]),g.parentNode.insertBefore(y,g.nextSibling),g=y}}),this.formEl.dataset.ptacExpanded="true"}createFooterSpacerTemplate(){const e=document.createElement("div");return e.classList.add("pfooter_spacer","paper_width"),e.style.height="0px",e}ensureFirstPageSections(e,t,r,a,i){let n=0;return t.header&&(u.appendClone(e,t.header,a,"pheader"),this.config.repeatHeader||(n+=r.header)),t.docInfos.forEach(l=>{const s=u.appendClone(e,l.element,a,l.className);this.registerPageNumberClone(s),this.config[l.repeatFlag]||(n+=r.docInfos[l.key]||0)}),t.rowHeader&&!i&&(u.appendClone(e,t.rowHeader,a,"prowheader"),this.config.repeatRowheader||(n+=r.rowHeader)),n}appendRepeatingSections(e,t,r,a){this.config.repeatHeader&&u.appendClone(e,t.header,r,"pheader"),t.docInfos.forEach(i=>{if(this.config[i.repeatFlag]){const n=u.appendClone(e,i.element,r,i.className);this.registerPageNumberClone(n)}}),this.config.repeatRowheader&&!a&&u.appendClone(e,t.rowHeader,r,"prowheader")}registerPageNumberClone(e){if(!e)return!1;let t=!1;if(this.showLogicalPageNumber&&e.querySelector("[data-page-number], [data-page-total], [data-page-number-container]")&&(T(e,this.currentPage,null),this.logicalPageNumberClones.push({node:e,pageNumber:this.currentPage}),t=!0),this.showPhysicalPageNumber&&e.querySelector("[data-physical-page-number], [data-physical-page-total], [data-physical-page-number-container]")){const r=this.logicalPageToPhysicalPage[this.currentPage]||this.currentPhysicalPage||1;x(e,r,null),this.physicalPageNumberClones.push({node:e,pageNumber:r}),t=!0}return t}appendRepeatingFooters(e,t,r){t.footerVariants.forEach(a=>{this.config[a.repeatFlag]&&u.appendClone(e,a.element,r,a.className)}),this.config.repeatFooterLogo&&u.appendClone(e,t.footerLogo,r,R.className),this.config.repeatFooterPagenum&&this.appendFooterPageNumber(e,t,r)}appendFinalFooters(e,t,r){t.footerVariants.forEach(a=>{u.appendClone(e,a.element,r,a.className)}),u.appendClone(e,t.footerLogo,r,R.className),this.appendFooterPageNumber(e,t,r)}appendFooterPageNumber(e,t,r){if(!t.footerPagenum)return;const a=t.footerPagenum.cloneNode(!0);e.appendChild(a),this.registerPageNumberClone(a),r&&r(`append ${L.className} page ${this.currentPage}`)}updatePageNumberTotals(){if(!this.logicalPageNumberClones.length&&!this.physicalPageNumberClones.length)return;const e=this.currentPage,t=this.currentPhysicalPage||1;this.logicalPageNumberClones.forEach(r=>{T(r.node,r.pageNumber,e)}),this.physicalPageNumberClones.forEach(r=>{x(r.node,r.pageNumber,t)})}measureSections(e){const t={header:u.measureHeight(e.header),docInfos:{},rowHeader:u.measureHeight(e.rowHeader),footerVariants:{},footerLogo:u.measureHeight(e.footerLogo),footerPagenum:u.measureHeight(e.footerPagenum)};return e.docInfos.forEach(r=>{t.docInfos[r.key]=u.measureHeight(r.element)}),e.footerVariants.forEach(r=>{t.footerVariants[r.key]=u.measureHeight(r.element)}),t}markSectionsProcessed(e){u.markAsProcessed(e.header,"pheader"),e.docInfos.forEach(t=>{u.markAsProcessed(t.element,t.className)}),u.markAsProcessed(e.rowHeader,"prowheader"),e.footerVariants.forEach(t=>{u.markAsProcessed(t.element,t.className)}),u.markAsProcessed(e.footerLogo,R.className),u.markAsProcessed(e.footerPagenum,L.className)}renderRows(e,t,r,a,i,n,l){let s=0;const p=this.initializePageContext(i);return this.debug&&(console.log("[printform] ===== renderRows START ====="),console.log(`[printform] Total rows: ${t.rows.length}, heightPerPage: ${i}px`)),t.rows.forEach((c,f)=>{const g=u.measureHeight(c),P=this.getRowBaseClass(c),y=this.isPtacRow(c),h=this.isPaddtRow(c);if(!g){u.markAsProcessed(c,P);return}if(s===0){this.refreshPageContextForRow(p,c,r);const w=this.getCurrentPageContainer(e);s+=this.ensureFirstPageSections(w,t,r,l,p.skipRowHeader),this.debug&&console.log(`[printform] Page ${this.currentPage} start: firstSectionHeight=${s}px, pageLimit=${p.limit}px`)}if(s+=g,this.debug&&console.log(`[printform]   row[${f}] height=${g}px, currentHeight=${s}px, limit=${p.limit}px`),u.markAsProcessed(c,P),c.classList.contains("tb_page_break_before")){this.debug&&console.log(`[printform]   >> PAGE BREAK (tb_page_break_before) at row[${f}]`),s-=g;const w=this.shouldSkipDummyRowItemsForContext(p),D=this.shouldSkipRowHeaderForRow(c);s=this.prepareNextPage(e,t,l,p.limit,s,a,n,D,w),this.refreshPageContextForRow(p,c,r);const E=this.getCurrentPageContainer(e);u.appendRowItem(E,c,l,f,P),s=g,this.debug&&console.log(`[printform] Page ${this.currentPage} start: currentHeight=${s}px, limit=${p.limit}px`),y||(p.isPtacPage=!1),h||(p.isPaddtPage=!1)}else if(s<=p.limit){const w=this.getCurrentPageContainer(e);u.appendRowItem(w,c,l,f,P),y||(p.isPtacPage=!1),h||(p.isPaddtPage=!1)}else{this.debug&&console.log(`[printform]   >> PAGE OVERFLOW at row[${f}]: ${s}px > limit ${p.limit}px`),s-=g;const w=this.shouldSkipDummyRowItemsForContext(p),D=this.shouldSkipRowHeaderForRow(c);s=this.prepareNextPage(e,t,l,p.limit,s,a,n,D,w),this.refreshPageContextForRow(p,c,r);const E=this.getCurrentPageContainer(e);u.appendRowItem(E,c,l,f,P),s=g,this.debug&&console.log(`[printform] Page ${this.currentPage} start: currentHeight=${s}px, limit=${p.limit}px`),y||(p.isPtacPage=!1),h||(p.isPaddtPage=!1)}}),this.debug&&console.log(`[printform] ===== renderRows END (page ${this.currentPage}, finalHeight=${s}px) =====`),{currentHeight:s,pageLimit:p.limit,isPtacPage:p.isPtacPage,isPaddtPage:p.isPaddtPage}}prepareNextPage(e,t,r,a,i,n,l,s,p){const c=this.getCurrentPageContainer(e),f=this.applyRemainderSpacing(c,a,i,n,l,{skipDummyRowItems:p});this.appendRepeatingFooters(c,t,r),this.currentPage+=1,this.currentPageContainer=null,this.createNewLogicalPage(e);const g=this.getCurrentPageContainer(e);return this.appendRepeatingSections(g,t,r,s),f}applyRemainderSpacing(e,t,r,a,i,n){const l=n&&n.skipDummyRowItems;let s=m(r);this.debug&&(console.log(`[printform] ----- applyRemainderSpacing (page ${this.currentPage}) -----`),console.log(`[printform]   heightPerPage: ${t}px, currentHeight: ${r}px`),console.log(`[printform]   skipDummyRowItems: ${l}`)),l||(s=le(this.config,e,t,s,this.debug)),s=pe(this.config,e,t,s,this.debug);const p=ce(this.config,e,t,s,l,this.debug);return s=p.currentHeight,p.skipFooterSpacer||de(this.config,e,t,s,a,i,this.debug),this.debug&&(console.log(`[printform]   finalHeight after spacing: ${s}px`),console.log("[printform] -----------------------------------------")),m(s)}computeHeightPerPage(e,t){let r=this.config.papersizeHeight;if(this.debug&&(console.log("[printform] ===== computeHeightPerPage ====="),console.log(`[printform] papersizeHeight (config): ${this.config.papersizeHeight}px`),console.log(`[printform] papersizeWidth (config): ${this.config.papersizeWidth}px`)),this.config.repeatHeader&&e.header&&(this.debug&&console.log(`[printform]   - repeatHeader: ${t.header}px`),r-=t.header),e.docInfos.forEach(a=>{if(this.config[a.repeatFlag]){const i=t.docInfos[a.key]||0;this.debug&&console.log(`[printform]   - repeat ${a.className}: ${i}px`),r-=i}}),this.config.repeatRowheader&&e.rowHeader&&(this.debug&&console.log(`[printform]   - repeatRowheader: ${t.rowHeader}px`),r-=t.rowHeader),e.footerVariants.forEach(a=>{if(this.config[a.repeatFlag]){const i=t.footerVariants[a.key]||0;this.debug&&console.log(`[printform]   - repeat ${a.className}: ${i}px`),r-=i}}),this.config.repeatFooterLogo&&e.footerLogo&&(this.debug&&console.log(`[printform]   - repeatFooterLogo: ${t.footerLogo}px`),r-=t.footerLogo),this.config.repeatFooterPagenum&&e.footerPagenum){const a=t.footerPagenum||0;this.debug&&console.log(`[printform]   - repeatFooterPagenum: ${a}px`),r-=a}return this.debug&&(console.log(`[printform] heightPerPage (available for content): ${Math.max(0,r)}px`),console.log("[printform] ================================")),Math.max(0,r)}computeFooterState(e,t){const r=t.footerLogo||0,a=t.footerPagenum||0,n=e.footerVariants.reduce((c,f)=>{const g=t.footerVariants[f.key]||0;return c+g},0)+r+a;let s=e.footerVariants.reduce((c,f)=>{const g=t.footerVariants[f.key]||0;return this.config[f.repeatFlag]?c+g:c},0);this.config.repeatFooterLogo&&(s+=r),this.config.repeatFooterPagenum&&(s+=a);const p=Math.max(0,n-s);return{totalFinal:n,repeating:s,nonRepeating:p}}finalizeDocument(e,t,r,a,i,n,l){const s=i?i.currentHeight:0,p=i&&i.pageLimit?i.pageLimit:a,c=!!(i&&(i.isPtacPage&&!this.config.insertPtacDummyRowItems||i.isPaddtPage&&!(this.paddtConfig&&this.paddtConfig.insertPaddtDummyRowItems))),f=r.totalFinal-r.repeating,g=s+f;if(g<=p){const h=this.getCurrentPageContainer(e);this.applyRemainderSpacing(h,p,g,r,n,{skipDummyRowItems:c}),this.appendFinalFooters(h,t,l);return}this.prepareNextPage(e,t,l,p,s,r,n,!1,c);const P=f,y=this.getCurrentPageContainer(e);this.applyRemainderSpacing(y,a,P,r,n,null),this.appendFinalFooters(y,t,l)}format(){const e=this.debug?this.log.bind(this):null,t=this.initializeOutputContainer();this.ensureCurrentPageContainer(t);const r=this.collectSections(),a=this.measureSections(r),i=this.createFooterSpacerTemplate();this.markSectionsProcessed(r);const n=this.computeFooterState(r,a),l=this.computeHeightPerPage(r,a),s=this.renderRows(t,r,a,n,l,i,e);if(this.finalizeDocument(t,r,n,l,s,i,e),this.paddtRows&&this.paddtRows.length){this.currentPage+=1,this.currentPageContainer=null,this.initializePhysicalWrapper(t),this.createNewLogicalPage(t);var p={docInfo:this.paddtConfig.repeatPaddtDocinfo,docInfo002:this.paddtConfig.repeatPaddtDocinfo002,docInfo003:this.paddtConfig.repeatPaddtDocinfo003,docInfo004:this.paddtConfig.repeatPaddtDocinfo004,docInfo005:this.paddtConfig.repeatPaddtDocinfo005},c=r.docInfos.filter(function(h){var w=p[h.key];return w===void 0?!0:!!w});const f={header:r.header,docInfos:c,rowHeader:r.rowHeader,footerVariants:[],footerLogo:r.footerLogo,footerPagenum:r.footerPagenum,rows:this.paddtRows},g=this.computeFooterState(f,a),P=this.computeHeightPerPage(f,a),y=this.renderRows(t,f,a,g,P,i,e);this.finalizeDocument(t,f,g,P,y,i,e)}return this.updatePageNumberTotals(),t.classList.add("printform_formatter_processed"),this.formEl.remove(),t}}function be(o){return new Promise((e,t)=>{setTimeout(e,o)})}async function z(o={}){const e=typeof window<"u"?window:globalThis;if(!e.__printFormProcessing&&!(!o.force&&e.__printFormProcessed)){e.__printFormProcessing=!0;try{const t=e.document;if(!t)return;const r=Array.from(t.querySelectorAll(".printform"));for(let a=0;a<r.length;a+=1){const i=r[a],n=V(i,o);try{await be(1)}catch(l){console.error("pauseInMilliseconds error",l)}try{const s=new O(i,n).format();a>0&&s&&s.parentNode&&s.parentNode.insertBefore(u.createPageBreakDivider(),s)}catch(l){console.error("printform format error",l)}}e.__printFormProcessed=!0}finally{e.__printFormProcessing=!1}}}function Se(o,e={}){const t=V(o,e);return new O(o,t).format()}const k={formatAll:z,format:Se,DEFAULT_CONFIG:_,DEFAULT_PADDT_CONFIG:F},S=typeof window<"u"?window:null;if(S)if(S.__printFormScriptLoaded__)S.PrintForm=S.PrintForm||k;else{S.__printFormScriptLoaded__=!0,S.PrintForm=S.PrintForm||{},Object.assign(S.PrintForm,k);const o=S.document;o&&o.addEventListener&&o.addEventListener("DOMContentLoaded",()=>{z()})}return k}();
